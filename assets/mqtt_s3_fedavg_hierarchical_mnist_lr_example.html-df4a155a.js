import{_ as a}from"./cross-silo-hi-2a73b75b.js";import{_ as t,r as e,o as p,c as o,a as c,b as n,d as i,w as u,e as l}from"./app-7ac5536a.js";const r="/FedML-Doc/assets/cross_silo_hi_arch_refactored-070e9a57.png",d={},k=l('<h1 id="fedml-octopus-heterogeneous-hierarchical-federated-learning" tabindex="-1"><a class="header-anchor" href="#fedml-octopus-heterogeneous-hierarchical-federated-learning" aria-hidden="true">#</a> FedML Octopus - Heterogeneous Hierarchical Federated Learning</h1><img src="'+a+`" alt="parrot" style="width:100%;"><p>This example illustrates how to do real-world hierarchical cross-silo federated learning with FedML Octopus. Hierarchical architecture allows a silo/client to take adavantage of multiple GPUs on different nodes to further accelerate training process. We use PyTorch&#39;s Distributed Data Parallel (DDP) to achieve this goal.</p><p>The example provided here demonstrates a scenario where there are two silos/clients, and each of them has access to multiple GPUs. Silo-1 trains the model on 2 nodes, with each node having 1 GPU, while Silo-2 trains its model using 1 GPU on a single node. The source code locates at <code>python/examples/cross_silo/mqtt_s3_fedavg_hierarchical_mnist_lr_example</code>.</p><blockquote><p><strong>If you have multiple nodes, you should run the client script on each node</strong></p></blockquote><h2 id="one-line-api" tabindex="-1"><a class="header-anchor" href="#one-line-api" aria-hidden="true">#</a> One line API</h2><p><code>python/examples/cross_silo/mqtt_s3_fedavg_hierarchical_mnist_lr_example/one_line</code></p><p>The highly encapsulated server and client API calls are shown as below:</p><p><code>run_server.sh</code> is as follows:</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token shebang important">#!/usr/bin/env bash</span>

python3 server/torch_server.py <span class="token parameter variable">--cf</span> config/fedml_config.yaml <span class="token parameter variable">--rank</span> <span class="token number">0</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>server/torch_server.py</code></p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">import</span> fedml


<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">&quot;__main__&quot;</span><span class="token punctuation">:</span>
    fedml<span class="token punctuation">.</span>run_hierarchical_cross_silo_server<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>run_client.sh</code></p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token shebang important">#!/usr/bin/env bash</span>
<span class="token assign-left variable">RANK</span><span class="token operator">=</span><span class="token variable">$1</span>

python3 client_dist_launcher.py <span class="token parameter variable">--cf</span> config/fedml_config.yaml <span class="token parameter variable">--rank</span> <span class="token variable">$RANK</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>client/torch_client.py</code></p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">import</span> fedml

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">&quot;__main__&quot;</span><span class="token punctuation">:</span>
    fedml<span class="token punctuation">.</span>run_hierarchical_cross_silo_client<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>At the client side, the client ID (a.k.a rank) starts from 1.</p><p>At the server side, run the following script:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>bash run_server.sh
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>For Silo/Client 1, run the following script on first node:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>bash run_client.sh 1
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>For Silo/Client 2, run the following script:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>bash run_client.sh 2
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><code>config/fedml_config.yaml</code> is shown below.</p><p>Here <code>common_args.training_type</code> is &quot;cross_silo&quot; type,<code>common_args.scenario</code> is hierarchical, and <code>train_args.client_id_list</code> needs to correspond to the client id in the client command line. Aslo, <code>private_config_paths</code> paths to configs specific to server or different silos. In this example, we have specified the configs paths for the server and two silos.</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">common_args</span><span class="token punctuation">:</span>
  <span class="token key atrule">training_type</span><span class="token punctuation">:</span> <span class="token string">&quot;cross_silo&quot;</span>
  <span class="token key atrule">scenario</span><span class="token punctuation">:</span> <span class="token string">&quot;hierarchical&quot;</span>
  <span class="token key atrule">using_mlops</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
  <span class="token key atrule">random_seed</span><span class="token punctuation">:</span> <span class="token number">0</span>

<span class="token key atrule">environment_args</span><span class="token punctuation">:</span>
  <span class="token key atrule">bootstrap</span><span class="token punctuation">:</span> config/bootstrap.sh

<span class="token key atrule">data_args</span><span class="token punctuation">:</span>
  <span class="token key atrule">dataset</span><span class="token punctuation">:</span> <span class="token string">&quot;mnist&quot;</span>
  <span class="token key atrule">data_cache_dir</span><span class="token punctuation">:</span> <span class="token string">&quot;./../../../../data/MNIST&quot;</span>
  <span class="token key atrule">partition_method</span><span class="token punctuation">:</span> <span class="token string">&quot;hetero&quot;</span>
  <span class="token key atrule">partition_alpha</span><span class="token punctuation">:</span> <span class="token number">0.5</span>

<span class="token key atrule">model_args</span><span class="token punctuation">:</span>
  <span class="token key atrule">model</span><span class="token punctuation">:</span> <span class="token string">&quot;lr&quot;</span>
  <span class="token key atrule">model_file_cache_folder</span><span class="token punctuation">:</span> <span class="token string">&quot;./model_file_cache&quot;</span> <span class="token comment"># will be filled by the server automatically</span>
  <span class="token key atrule">global_model_file_path</span><span class="token punctuation">:</span> <span class="token string">&quot;./model_file_cache/global_model.pt&quot;</span>

<span class="token key atrule">train_args</span><span class="token punctuation">:</span>
  <span class="token key atrule">federated_optimizer</span><span class="token punctuation">:</span> <span class="token string">&quot;FedAvg&quot;</span>
  <span class="token key atrule">client_id_list</span><span class="token punctuation">:</span>
  <span class="token key atrule">client_num_in_total</span><span class="token punctuation">:</span> <span class="token number">2</span>
  <span class="token key atrule">client_num_per_round</span><span class="token punctuation">:</span> <span class="token number">2</span>
  <span class="token key atrule">comm_round</span><span class="token punctuation">:</span> <span class="token number">50</span>
  <span class="token key atrule">epochs</span><span class="token punctuation">:</span> <span class="token number">1</span>
  <span class="token key atrule">batch_size</span><span class="token punctuation">:</span> <span class="token number">10</span>
  <span class="token key atrule">client_optimizer</span><span class="token punctuation">:</span> sgd
  <span class="token key atrule">learning_rate</span><span class="token punctuation">:</span> <span class="token number">0.001</span>
  <span class="token key atrule">weight_decay</span><span class="token punctuation">:</span> <span class="token number">0.001</span>

<span class="token key atrule">validation_args</span><span class="token punctuation">:</span>
  <span class="token key atrule">frequency_of_the_test</span><span class="token punctuation">:</span> <span class="token number">5</span>

<span class="token key atrule">device_args</span><span class="token punctuation">:</span>
  <span class="token key atrule">using_gpu</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
  <span class="token key atrule">gpu_mapping_file</span><span class="token punctuation">:</span> config/gpu_mapping.yaml
  <span class="token key atrule">server_gpu_mapping_key</span><span class="token punctuation">:</span> mapping_default

<span class="token key atrule">comm_args</span><span class="token punctuation">:</span>
  <span class="token key atrule">backend</span><span class="token punctuation">:</span> <span class="token string">&quot;MQTT_S3&quot;</span>
  <span class="token key atrule">mqtt_config_path</span><span class="token punctuation">:</span>
  <span class="token key atrule">s3_config_path</span><span class="token punctuation">:</span>
  
<span class="token key atrule">tracking_args</span><span class="token punctuation">:</span>
  <span class="token key atrule">log_file_dir</span><span class="token punctuation">:</span> ./log
  <span class="token key atrule">local_log_output_path</span><span class="token punctuation">:</span> ./log
  <span class="token key atrule">enable_wandb</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
  <span class="token key atrule">wandb_key</span><span class="token punctuation">:</span> ee0b5f53d949c84cee7decbe7a619e63fb1f8408
  <span class="token key atrule">wandb_project</span><span class="token punctuation">:</span> fedml
  <span class="token key atrule">wandb_name</span><span class="token punctuation">:</span> fedml_torch_fedavg_mnist_lr

<span class="token key atrule">private_config_paths</span><span class="token punctuation">:</span>
  <span class="token key atrule">server_config_path</span><span class="token punctuation">:</span> config/server.yaml
  <span class="token key atrule">client_silo_config_paths</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
    config/silo_1.yaml<span class="token punctuation">,</span>
    config/silo_2.yaml
  <span class="token punctuation">]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>For this example we use the following as <code>config/server.yaml</code>, <code>config/silo-1.yaml</code> and <code>config/silo-2.yaml</code> respectively.</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token comment"># config/server.yaml</span>
<span class="token key atrule">device_args</span><span class="token punctuation">:</span>
  <span class="token key atrule">using_gpu</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
  <span class="token key atrule">gpu_mapping_file</span><span class="token punctuation">:</span> config/gpu_mapping.yaml
  <span class="token key atrule">gpu_mapping_key</span><span class="token punctuation">:</span> mapping_server
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token comment"># config/silo-2.yaml</span>
<span class="token key atrule">dist_training_args</span><span class="token punctuation">:</span>
  <span class="token key atrule">n_node_in_silo</span><span class="token punctuation">:</span> <span class="token number">2</span>
  <span class="token key atrule">n_proc_per_node</span><span class="token punctuation">:</span> <span class="token number">2</span>
  <span class="token key atrule">node_addresses</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>192.168.1.1<span class="token punctuation">,</span> 192.168.1.2<span class="token punctuation">]</span>
  <span class="token key atrule">master_address</span><span class="token punctuation">:</span> <span class="token string">&#39;192.168.1.1&#39;</span>
  <span class="token key atrule">launcher_rdzv_port</span><span class="token punctuation">:</span> <span class="token number">29410</span>
  <span class="token key atrule">network_interface</span><span class="token punctuation">:</span> ens5

<span class="token key atrule">device_args</span><span class="token punctuation">:</span>
  <span class="token key atrule">using_gpu</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
  <span class="token key atrule">gpu_mapping_file</span><span class="token punctuation">:</span> config/gpu_mapping.yaml
  <span class="token key atrule">gpu_mapping_key</span><span class="token punctuation">:</span> mapping_silo_1
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token comment"># config/silo-2.yaml</span>
<span class="token key atrule">dist_training_args</span><span class="token punctuation">:</span>
  <span class="token key atrule">n_node_in_silo</span><span class="token punctuation">:</span> <span class="token number">2</span>
  <span class="token key atrule">n_proc_per_node</span><span class="token punctuation">:</span> <span class="token number">1</span>
  <span class="token key atrule">node_addresses</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>192.168.1.3<span class="token punctuation">]</span>
  <span class="token key atrule">master_address</span><span class="token punctuation">:</span> <span class="token string">&#39;192.168.1.3&#39;</span>
  <span class="token key atrule">launcher_rdzv_port</span><span class="token punctuation">:</span> <span class="token number">29410</span>
  <span class="token key atrule">network_interface</span><span class="token punctuation">:</span> lo

<span class="token key atrule">device_args</span><span class="token punctuation">:</span>
  <span class="token key atrule">using_gpu</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
  <span class="token key atrule">gpu_mapping_file</span><span class="token punctuation">:</span> config/gpu_mapping.yaml
  <span class="token key atrule">gpu_mapping_key</span><span class="token punctuation">:</span> mapping_silo_2


</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Here <code>dist_training_args</code> defines the distributed training hierarchy for each silo where:</p><ul><li><code>n_node_in_silo</code> is number of nodes in silo</li><li><code>n_proc_per_node</code> is number of processes (distributed trainers) in each node.</li><li><code>master_address</code> is ip address of the process group master. This should be the ip of the first node in node_addresses.</li><li><code>node_addresses</code> is addresses of the nodes inside silo.</li><li><code>launcher_rdzv_port</code> is port of on the process group master which is used for rendezvous.</li></ul><p>Please note in order to run distributed training:</p><ol><li>You need to have <code>pdsh</code> and <code>fedml</code> installed on all nodes in silo.</li><li>Python executable path should be same for all nodes in silo.</li><li>The first node in <code>dist_training_args.node_addresses</code> should be the same as master_address.</li><li>The node executing <code>run_client.sh</code> should have passwrodless ssh access to the nodes in <code>dist_training_args.node_addresses</code>.</li><li>All of the nodes in <code>dist_training_args.node_addresses</code> should be able to access <code>dist_training_args.master_address</code> through <code>dist_training_args.network_interface</code>. You can use the <code>ifconfig</code> command to get a list of available interfaces and their corresponding ip addresses.</li></ol><p>Furthermore, <code>device_args</code> in each of the config files defines the device configs for the corresponding server/silo. In this example, as presented by <code>config/silo-2.yaml</code>, Silo 1 has 2 nodes with 1 processes on each. Therefore, Silo 1 has 2 processes in total. To match this setting, <code>mapping_silo_1</code> defined in <code>config/gpu_mapping.yaml</code> should contain 2 nodes with 1 workers each.</p><h3 id="training-results" tabindex="-1"><a class="header-anchor" href="#training-results" aria-hidden="true">#</a> Training Results</h3><p>At the end of the 50th training round, the server window will see the following output:</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>03:test_on_server_for_all_clients<span class="token punctuation">]</span> <span class="token comment">################test_on_server_for_all_clients : 49</span>
<span class="token punctuation">[</span>FedML-Server<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> @device-id-0<span class="token punctuation">]</span> <span class="token punctuation">[</span>Mon, 04 Jul <span class="token number">2022</span> 06:20:22<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token punctuation">[</span>fedml_aggregator.py:230:test_on_server_for_all_clients<span class="token punctuation">]</span> <span class="token punctuation">{</span><span class="token string">&#39;training_acc&#39;</span><span class="token builtin class-name">:</span> <span class="token number">0.13014076284379866</span>, <span class="token string">&#39;training_loss&#39;</span><span class="token builtin class-name">:</span> <span class="token number">2.290751568969198</span><span class="token punctuation">}</span>
<span class="token punctuation">[</span>FedML-Server<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> @device-id-0<span class="token punctuation">]</span> <span class="token punctuation">[</span>Mon, 04 Jul <span class="token number">2022</span> 06:20:22<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token punctuation">[</span>fedml_server_manager.py:166:handle_message_receive_model_from_client<span class="token punctuation">]</span> aggregator.test exception: <span class="token string">&#39;NoneType&#39;</span> object has no attribute <span class="token string">&#39;report_server_training_metric&#39;</span>
<span class="token punctuation">[</span>FedML-Server<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> @device-id-0<span class="token punctuation">]</span> <span class="token punctuation">[</span>Mon, 04 Jul <span class="token number">2022</span> 06:20:22<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token punctuation">[</span>fedml_aggregator.py:122:data_silo_selection<span class="token punctuation">]</span> client_num_in_total <span class="token operator">=</span> <span class="token number">1000</span>, client_num_per_round <span class="token operator">=</span> <span class="token number">2</span>
<span class="token punctuation">[</span>FedML-Server<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> @device-id-0<span class="token punctuation">]</span> <span class="token punctuation">[</span>Mon, 04 Jul <span class="token number">2022</span> 06:20:22<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token punctuation">[</span>fedml_server_manager.py:240:send_message_sync_model_to_client<span class="token punctuation">]</span> send_message_sync_model_to_client. receive_id <span class="token operator">=</span> <span class="token number">1</span>
<span class="token punctuation">[</span>FedML-Server<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> @device-id-0<span class="token punctuation">]</span> <span class="token punctuation">[</span>Mon, 04 Jul <span class="token number">2022</span> 06:20:22<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token punctuation">[</span>mqtt_s3_multi_clients_comm_manager.py:208:send_message<span class="token punctuation">]</span> mqtt_s3.send_message: starting<span class="token punctuation">..</span>.
<span class="token punctuation">[</span>FedML-Server<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> @device-id-0<span class="token punctuation">]</span> <span class="token punctuation">[</span>Mon, 04 Jul <span class="token number">2022</span> 06:20:22<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token punctuation">[</span>mqtt_s3_multi_clients_comm_manager.py:214:send_message<span class="token punctuation">]</span> mqtt_s3.send_message: msg topic <span class="token operator">=</span> fedml_0_0_1
<span class="token punctuation">[</span>FedML-Server<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> @device-id-0<span class="token punctuation">]</span> <span class="token punctuation">[</span>Mon, 04 Jul <span class="token number">2022</span> 06:20:22<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token punctuation">[</span>mqtt_s3_multi_clients_comm_manager.py:221:send_message<span class="token punctuation">]</span> mqtt_s3.send_message: S3+MQTT msg sent, s3 message key <span class="token operator">=</span> fedml_0_0_1_7defbea3-0a43-48d5-a576-e17a23b5692b
<span class="token punctuation">[</span>FedML-Server<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> @device-id-0<span class="token punctuation">]</span> <span class="token punctuation">[</span>Mon, 04 Jul <span class="token number">2022</span> 06:20:22<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token punctuation">[</span>mqtt_s3_multi_clients_comm_manager.py:225:send_message<span class="token punctuation">]</span> mqtt_s3.send_message: to python client.
<span class="token punctuation">[</span>FedML-Server<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> @device-id-0<span class="token punctuation">]</span> <span class="token punctuation">[</span>Mon, 04 Jul <span class="token number">2022</span> 06:20:23<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token punctuation">[</span>fedml_server_manager.py:240:send_message_sync_model_to_client<span class="token punctuation">]</span> send_message_sync_model_to_client. receive_id <span class="token operator">=</span> <span class="token number">2</span>
<span class="token punctuation">[</span>FedML-Server<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> @device-id-0<span class="token punctuation">]</span> <span class="token punctuation">[</span>Mon, 04 Jul <span class="token number">2022</span> 06:20:23<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token punctuation">[</span>mqtt_s3_multi_clients_comm_manager.py:208:send_message<span class="token punctuation">]</span> mqtt_s3.send_message: starting<span class="token punctuation">..</span>.
<span class="token punctuation">[</span>FedML-Server<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> @device-id-0<span class="token punctuation">]</span> <span class="token punctuation">[</span>Mon, 04 Jul <span class="token number">2022</span> 06:20:23<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token punctuation">[</span>mqtt_s3_multi_clients_comm_manager.py:214:send_message<span class="token punctuation">]</span> mqtt_s3.send_message: msg topic <span class="token operator">=</span> fedml_0_0_2
<span class="token punctuation">[</span>FedML-Server<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> @device-id-0<span class="token punctuation">]</span> <span class="token punctuation">[</span>Mon, 04 Jul <span class="token number">2022</span> 06:20:23<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token punctuation">[</span>mqtt_s3_multi_clients_comm_manager.py:221:send_message<span class="token punctuation">]</span> mqtt_s3.send_message: S3+MQTT msg sent, s3 message key <span class="token operator">=</span> fedml_0_0_2_1b5ac43c-adec-431c-b343-88e78ce96567
<span class="token punctuation">[</span>FedML-Server<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> @device-id-0<span class="token punctuation">]</span> <span class="token punctuation">[</span>Mon, 04 Jul <span class="token number">2022</span> 06:20:23<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token punctuation">[</span>mqtt_s3_multi_clients_comm_manager.py:225:send_message<span class="token punctuation">]</span> mqtt_s3.send_message: to python client.
<span class="token punctuation">[</span>FedML-Server<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> @device-id-0<span class="token punctuation">]</span> <span class="token punctuation">[</span>Mon, 04 Jul <span class="token number">2022</span> 06:20:23<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token punctuation">[</span>server_manager.py:144:finish<span class="token punctuation">]</span> __finish server
<span class="token punctuation">[</span>FedML-Server<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> @device-id-0<span class="token punctuation">]</span> <span class="token punctuation">[</span>Mon, 04 Jul <span class="token number">2022</span> 06:20:23<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token punctuation">[</span>mqtt_s3_multi_clients_comm_manager.py:278:stop_receive_message<span class="token punctuation">]</span> mqtt_s3.stop_receive_message: stopping<span class="token punctuation">..</span>.
<span class="token punctuation">[</span>FedML-Server<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> @device-id-0<span class="token punctuation">]</span> <span class="token punctuation">[</span>Mon, 04 Jul <span class="token number">2022</span> 06:20:23<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token punctuation">[</span>mqtt_manager.py:98:on_disconnect<span class="token punctuation">]</span> on_disconnect <span class="token assign-left variable">code</span><span class="token operator">=</span><span class="token number">0</span>
<span class="token punctuation">[</span>FedML-Server<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> @device-id-0<span class="token punctuation">]</span> <span class="token punctuation">[</span>Mon, 04 Jul <span class="token number">2022</span> 06:20:23<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token punctuation">[</span>mqtt_s3_multi_clients_comm_manager.py:140:on_disconnected<span class="token punctuation">]</span> mqtt_s3.on_disconnected
<span class="token punctuation">[</span>FedML-Server<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> @device-id-0<span class="token punctuation">]</span> <span class="token punctuation">[</span>Mon, 04 Jul <span class="token number">2022</span> 06:20:23<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token punctuation">[</span>server_manager.py:112:run<span class="token punctuation">]</span> running
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>At the end of the 50th training round, client1 window will see the following output:</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token number">172.31</span>.31.190: <span class="token punctuation">[</span>FedML-Client<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> @device-id-1<span class="token punctuation">]</span> <span class="token punctuation">[</span>Mon, 04 Jul <span class="token number">2022</span> 06:20:22<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token punctuation">[</span>fedml_client_master_manager.py:157:handle_message_receive_model_from_server<span class="token punctuation">]</span> <span class="token comment">#######training########### round_id = 49</span>
<span class="token number">172.31</span>.21.76: <span class="token punctuation">[</span>FedML-Client<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> @device-id-1<span class="token punctuation">]</span> <span class="token punctuation">[</span>Mon, 04 Jul <span class="token number">2022</span> 06:20:22<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token punctuation">[</span>fedml_client_slave_manager.py:46:await_sync_process_group<span class="token punctuation">]</span> prcoess <span class="token number">1</span> received round_number <span class="token number">49</span>
<span class="token number">172.31</span>.31.190: <span class="token punctuation">[</span>FedML-Client<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> @device-id-1<span class="token punctuation">]</span> <span class="token punctuation">[</span>Mon, 04 Jul <span class="token number">2022</span> 06:20:22<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token punctuation">[</span>my_model_trainer_classification.py:44:train<span class="token punctuation">]</span> Update Epoch: <span class="token number">0</span> <span class="token punctuation">[</span><span class="token number">64</span>/64 <span class="token punctuation">(</span><span class="token number">100</span>%<span class="token punctuation">)</span><span class="token punctuation">]</span>	Loss: <span class="token number">2.333926</span>
<span class="token number">172.31</span>.31.190: <span class="token punctuation">[</span>FedML-Client<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> @device-id-1<span class="token punctuation">]</span> <span class="token punctuation">[</span>Mon, 04 Jul <span class="token number">2022</span> 06:20:22<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token punctuation">[</span>my_model_trainer_classification.py:55:train<span class="token punctuation">]</span> Client Index <span class="token operator">=</span> <span class="token number">0</span>	Epoch: <span class="token number">0</span>	Loss: <span class="token number">2.333926</span>
<span class="token number">172.31</span>.21.76: <span class="token punctuation">[</span>FedML-Client<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> @device-id-1<span class="token punctuation">]</span> <span class="token punctuation">[</span>Mon, 04 Jul <span class="token number">2022</span> 06:20:22<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token punctuation">[</span>my_model_trainer_classification.py:44:train<span class="token punctuation">]</span> Update Epoch: <span class="token number">0</span> <span class="token punctuation">[</span><span class="token number">64</span>/64 <span class="token punctuation">(</span><span class="token number">100</span>%<span class="token punctuation">)</span><span class="token punctuation">]</span>	Loss: <span class="token number">2.333926</span>
<span class="token number">172.31</span>.21.76: <span class="token punctuation">[</span>FedML-Client<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> @device-id-1<span class="token punctuation">]</span> <span class="token punctuation">[</span>Mon, 04 Jul <span class="token number">2022</span> 06:20:22<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token punctuation">[</span>my_model_trainer_classification.py:55:train<span class="token punctuation">]</span> Client Index <span class="token operator">=</span> <span class="token number">0</span>	Epoch: <span class="token number">0</span>	Loss: <span class="token number">2.333926</span>
<span class="token number">172.31</span>.31.190: <span class="token punctuation">[</span>FedML-Client<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> @device-id-1<span class="token punctuation">]</span> <span class="token punctuation">[</span>Mon, 04 Jul <span class="token number">2022</span> 06:20:22<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token punctuation">[</span>client_manager.py:133:send_message<span class="token punctuation">]</span> Sending message <span class="token punctuation">(</span>type <span class="token number">3</span><span class="token punctuation">)</span> to server
<span class="token number">172.31</span>.31.190: <span class="token punctuation">[</span>FedML-Client<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> @device-id-1<span class="token punctuation">]</span> <span class="token punctuation">[</span>Mon, 04 Jul <span class="token number">2022</span> 06:20:22<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token punctuation">[</span>mqtt_s3_multi_clients_comm_manager.py:208:send_message<span class="token punctuation">]</span> mqtt_s3.send_message: starting<span class="token punctuation">..</span>.
<span class="token number">172.31</span>.21.76: <span class="token punctuation">[</span>FedML-Client<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> @device-id-1<span class="token punctuation">]</span> <span class="token punctuation">[</span>Mon, 04 Jul <span class="token number">2022</span> 06:20:22<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token punctuation">[</span>fedml_client_slave_manager.py:39:await_sync_process_group<span class="token punctuation">]</span> prcoess <span class="token number">1</span> waiting <span class="token keyword">for</span> round number
<span class="token number">172.31</span>.31.190: <span class="token punctuation">[</span>FedML-Client<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> @device-id-1<span class="token punctuation">]</span> <span class="token punctuation">[</span>Mon, 04 Jul <span class="token number">2022</span> 06:20:22<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token punctuation">[</span>mqtt_s3_multi_clients_comm_manager.py:251:send_message<span class="token punctuation">]</span> mqtt_s3.send_message: S3+MQTT msg sent, message_key <span class="token operator">=</span> fedml_0_1_4e0e5970-a9c0-4a74-9ad1-64eea9675591
<span class="token number">172.31</span>.31.190: <span class="token punctuation">[</span>FedML-Client<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> @device-id-1<span class="token punctuation">]</span> <span class="token punctuation">[</span>Mon, 04 Jul <span class="token number">2022</span> 06:20:22<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token punctuation">[</span>mqtt_s3_multi_clients_comm_manager.py:255:send_message<span class="token punctuation">]</span> mqtt_s3.send_message: to python client.
<span class="token number">172.31</span>.31.190: <span class="token punctuation">[</span>FedML-Client<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> @device-id-1<span class="token punctuation">]</span> <span class="token punctuation">[</span>Mon, 04 Jul <span class="token number">2022</span> 06:20:22<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token punctuation">[</span>mqtt_manager.py:94:on_publish<span class="token punctuation">]</span> on_publish <span class="token assign-left variable">mid</span><span class="token operator">=</span><span class="token number">52</span>
<span class="token number">172.31</span>.31.190: <span class="token punctuation">[</span>FedML-Client<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> @device-id-1<span class="token punctuation">]</span> <span class="token punctuation">[</span>Mon, 04 Jul <span class="token number">2022</span> 06:20:23<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token punctuation">[</span>mqtt_manager.py:84:on_message<span class="token punctuation">]</span> on_message<span class="token punctuation">(</span>fedml_0_0_1, b<span class="token string">&#39;{&quot;msg_type&quot;: 2, &quot;sender&quot;: 0, &quot;receiver&quot;: 1, &quot;model_params&quot;: &quot;fedml_0_0_1_7defbea3-0a43-48d5-a576-e17a23b5692b&quot;, &quot;client_idx&quot;: &quot;318&quot;, &quot;client_os&quot;: &quot;PythonClient&quot;, &quot;model_params_url&quot;: &quot;https://fedml.s3.amazonaws.com/fedml_0_0_1_7defbea3-0a43-48d5-a576-e17a23b5692b?AWSAccessKeyId=AKIAUAWARWF4SW36VYXP&amp;Signature=pna90%2BU5oyoRdbMKqSn3JqsCjS4%3D&amp;Expires=1657347623&quot;}&#39;</span><span class="token punctuation">)</span>
<span class="token number">172.31</span>.31.190: <span class="token punctuation">[</span>FedML-Client<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> @device-id-1<span class="token punctuation">]</span> <span class="token punctuation">[</span>Mon, 04 Jul <span class="token number">2022</span> 06:20:23<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token punctuation">[</span>mqtt_s3_multi_clients_comm_manager.py:173:_on_message_impl<span class="token punctuation">]</span> mqtt_s3.on_message: use s3 pack, s3 message key fedml_0_0_1_7defbea3-0a43-48d5-a576-e17a23b5692b
<span class="token number">172.31</span>.31.190: <span class="token punctuation">[</span>FedML-Client<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> @device-id-1<span class="token punctuation">]</span> <span class="token punctuation">[</span>Mon, 04 Jul <span class="token number">2022</span> 06:20:23<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token punctuation">[</span>mqtt_s3_multi_clients_comm_manager.py:177:_on_message_impl<span class="token punctuation">]</span> mqtt_s3.on_message: from python client.
<span class="token number">172.31</span>.31.190: <span class="token punctuation">[</span>FedML-Client<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> @device-id-1<span class="token punctuation">]</span> <span class="token punctuation">[</span>Mon, 04 Jul <span class="token number">2022</span> 06:20:23<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token punctuation">[</span>mqtt_s3_multi_clients_comm_manager.py:180:_on_message_impl<span class="token punctuation">]</span> mqtt_s3.on_message: model params length <span class="token number">2</span>
<span class="token number">172.31</span>.31.190: <span class="token punctuation">[</span>FedML-Client<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> @device-id-1<span class="token punctuation">]</span> <span class="token punctuation">[</span>Mon, 04 Jul <span class="token number">2022</span> 06:20:23<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token punctuation">[</span>mqtt_s3_multi_clients_comm_manager.py:160:_notify<span class="token punctuation">]</span> mqtt_s3.notify: msg <span class="token builtin class-name">type</span> <span class="token operator">=</span> <span class="token number">2</span>
<span class="token number">172.31</span>.31.190: <span class="token punctuation">[</span>FedML-Client<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> @device-id-1<span class="token punctuation">]</span> <span class="token punctuation">[</span>Mon, 04 Jul <span class="token number">2022</span> 06:20:23<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token punctuation">[</span>fedml_client_master_manager.py:135:handle_message_receive_model_from_server<span class="token punctuation">]</span> handle_message_receive_model_from_server.
<span class="token number">172.31</span>.31.190: <span class="token punctuation">[</span>FedML-Client<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> @device-id-1<span class="token punctuation">]</span> <span class="token punctuation">[</span>Mon, 04 Jul <span class="token number">2022</span> 06:20:23<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token punctuation">[</span>fedml_client_master_manager.py:248:sync_process_group<span class="token punctuation">]</span> sending round number to pg
<span class="token number">172.31</span>.31.190: <span class="token punctuation">[</span>FedML-Client<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> @device-id-1<span class="token punctuation">]</span> <span class="token punctuation">[</span>Mon, 04 Jul <span class="token number">2022</span> 06:20:23<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token punctuation">[</span>fedml_client_master_manager.py:255:sync_process_group<span class="token punctuation">]</span> round number <span class="token number">50</span> broadcasted to process group
<span class="token number">172.31</span>.31.190: <span class="token punctuation">[</span>FedML-Client<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> @device-id-1<span class="token punctuation">]</span> <span class="token punctuation">[</span>Mon, 04 Jul <span class="token number">2022</span> 06:20:23<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token punctuation">[</span>fedml_client_master_manager.py:166:finish<span class="token punctuation">]</span> Training finished <span class="token keyword">for</span> master client rank <span class="token number">0</span> <span class="token keyword">in</span> silo <span class="token number">0</span>
<span class="token number">172.31</span>.31.190: <span class="token punctuation">[</span>FedML-Client<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> @device-id-1<span class="token punctuation">]</span> <span class="token punctuation">[</span>Mon, 04 Jul <span class="token number">2022</span> 06:20:23<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token punctuation">[</span>fedml_trainer_dist_adapter.py:130:cleanup_pg<span class="token punctuation">]</span> Cleaningup process group <span class="token keyword">for</span> client <span class="token number">0</span> <span class="token keyword">in</span> silo <span class="token number">0</span>
<span class="token number">172.31</span>.21.76: <span class="token punctuation">[</span>FedML-Client<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> @device-id-1<span class="token punctuation">]</span> <span class="token punctuation">[</span>Mon, 04 Jul <span class="token number">2022</span> 06:20:23<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token punctuation">[</span>fedml_client_slave_manager.py:46:await_sync_process_group<span class="token punctuation">]</span> prcoess <span class="token number">1</span> received round_number <span class="token number">50</span>
<span class="token number">172.31</span>.21.76: <span class="token punctuation">[</span>FedML-Client<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> @device-id-1<span class="token punctuation">]</span> <span class="token punctuation">[</span>Mon, 04 Jul <span class="token number">2022</span> 06:20:23<span class="token punctuation">]</span> <span class="token punctuation">[</span>WARNING<span class="token punctuation">]</span> <span class="token punctuation">[</span>fedml_client_slave_manager.py:23:train<span class="token punctuation">]</span> Finishing Client Slave
<span class="token number">172.31</span>.21.76: <span class="token punctuation">[</span>FedML-Client<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> @device-id-1<span class="token punctuation">]</span> <span class="token punctuation">[</span>Mon, 04 Jul <span class="token number">2022</span> 06:20:23<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token punctuation">[</span>fedml_trainer_dist_adapter.py:130:cleanup_pg<span class="token punctuation">]</span> Cleaningup process group <span class="token keyword">for</span> client <span class="token number">1</span> <span class="token keyword">in</span> silo <span class="token number">0</span>
<span class="token number">172.31</span>.21.76: <span class="token punctuation">[</span>FedML-Client<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> @device-id-1<span class="token punctuation">]</span> <span class="token punctuation">[</span>Mon, 04 Jul <span class="token number">2022</span> 06:20:23<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token punctuation">[</span>fedml_client_slave_manager.py:32:finish<span class="token punctuation">]</span> Training finsihded <span class="token keyword">for</span> slave client rank <span class="token number">1</span> <span class="token keyword">in</span> silo <span class="token number">0</span>
<span class="token number">172.31</span>.31.190: <span class="token punctuation">[</span>FedML-Client<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> @device-id-1<span class="token punctuation">]</span> <span class="token punctuation">[</span>Mon, 04 Jul <span class="token number">2022</span> 06:20:23<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token punctuation">[</span>client_manager.py:147:finish<span class="token punctuation">]</span> __finish client
<span class="token number">172.31</span>.31.190: <span class="token punctuation">[</span>FedML-Client<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> @device-id-1<span class="token punctuation">]</span> <span class="token punctuation">[</span>Mon, 04 Jul <span class="token number">2022</span> 06:20:23<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token punctuation">[</span>mqtt_s3_multi_clients_comm_manager.py:278:stop_receive_message<span class="token punctuation">]</span> mqtt_s3.stop_receive_message: stopping<span class="token punctuation">..</span>.
<span class="token number">172.31</span>.31.190: <span class="token punctuation">[</span>FedML-Client<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> @device-id-1<span class="token punctuation">]</span> <span class="token punctuation">[</span>Mon, 04 Jul <span class="token number">2022</span> 06:20:23<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token punctuation">[</span>mqtt_manager.py:98:on_disconnect<span class="token punctuation">]</span> on_disconnect <span class="token assign-left variable">code</span><span class="token operator">=</span><span class="token number">0</span>
<span class="token number">172.31</span>.31.190: <span class="token punctuation">[</span>FedML-Client<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> @device-id-1<span class="token punctuation">]</span> <span class="token punctuation">[</span>Mon, 04 Jul <span class="token number">2022</span> 06:20:23<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token punctuation">[</span>mqtt_s3_multi_clients_comm_manager.py:140:on_disconnected<span class="token punctuation">]</span> mqtt_s3.on_disconnected
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>At the end of the 50th training round, the client2 window will see the following output:</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>FedML-Client<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> @device-id-2<span class="token punctuation">]</span> <span class="token punctuation">[</span>Sun, 03 Jul <span class="token number">2022</span> <span class="token number">23</span>:20:22<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token punctuation">[</span>fedml_client_master_manager.py:158:handle_message_receive_model_from_server<span class="token punctuation">]</span> <span class="token comment">#######training########### round_id = 49</span>
<span class="token punctuation">[</span>FedML-Client<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> @device-id-2<span class="token punctuation">]</span> <span class="token punctuation">[</span>Sun, 03 Jul <span class="token number">2022</span> <span class="token number">23</span>:20:22<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token punctuation">[</span>my_model_trainer_classification.py:44:train<span class="token punctuation">]</span> Update Epoch: <span class="token number">0</span> <span class="token punctuation">[</span><span class="token number">64</span>/192 <span class="token punctuation">(</span><span class="token number">33</span>%<span class="token punctuation">)</span><span class="token punctuation">]</span>  Loss: <span class="token number">2.310319</span>
<span class="token punctuation">[</span>FedML-Client<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> @device-id-2<span class="token punctuation">]</span> <span class="token punctuation">[</span>Sun, 03 Jul <span class="token number">2022</span> <span class="token number">23</span>:20:22<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token punctuation">[</span>my_model_trainer_classification.py:44:train<span class="token punctuation">]</span> Update Epoch: <span class="token number">0</span> <span class="token punctuation">[</span><span class="token number">128</span>/192 <span class="token punctuation">(</span><span class="token number">67</span>%<span class="token punctuation">)</span><span class="token punctuation">]</span> Loss: <span class="token number">2.302589</span>
<span class="token punctuation">[</span>FedML-Client<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> @device-id-2<span class="token punctuation">]</span> <span class="token punctuation">[</span>Sun, 03 Jul <span class="token number">2022</span> <span class="token number">23</span>:20:22<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token punctuation">[</span>my_model_trainer_classification.py:44:train<span class="token punctuation">]</span> Update Epoch: <span class="token number">0</span> <span class="token punctuation">[</span><span class="token number">192</span>/192 <span class="token punctuation">(</span><span class="token number">100</span>%<span class="token punctuation">)</span><span class="token punctuation">]</span>       Loss: <span class="token number">2.310704</span>
<span class="token punctuation">[</span>FedML-Client<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> @device-id-2<span class="token punctuation">]</span> <span class="token punctuation">[</span>Sun, 03 Jul <span class="token number">2022</span> <span class="token number">23</span>:20:22<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token punctuation">[</span>my_model_trainer_classification.py:55:train<span class="token punctuation">]</span> Client Index <span class="token operator">=</span> <span class="token number">1</span>        Epoch: <span class="token number">0</span>       Loss: <span class="token number">2.307871</span>
<span class="token punctuation">[</span>FedML-Client<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> @device-id-2<span class="token punctuation">]</span> <span class="token punctuation">[</span>Sun, 03 Jul <span class="token number">2022</span> <span class="token number">23</span>:20:22<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token punctuation">[</span>client_manager.py:133:send_message<span class="token punctuation">]</span> Sending message <span class="token punctuation">(</span>type <span class="token number">3</span><span class="token punctuation">)</span> to server
<span class="token punctuation">[</span>FedML-Client<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> @device-id-2<span class="token punctuation">]</span> <span class="token punctuation">[</span>Sun, 03 Jul <span class="token number">2022</span> <span class="token number">23</span>:20:22<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token punctuation">[</span>mqtt_s3_multi_clients_comm_manager.py:208:send_message<span class="token punctuation">]</span> mqtt_s3.send_message: starting<span class="token punctuation">..</span>.
<span class="token punctuation">[</span>FedML-Client<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> @device-id-2<span class="token punctuation">]</span> <span class="token punctuation">[</span>Sun, 03 Jul <span class="token number">2022</span> <span class="token number">23</span>:20:22<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token punctuation">[</span>mqtt_s3_multi_clients_comm_manager.py:251:send_message<span class="token punctuation">]</span> mqtt_s3.send_message: S3+MQTT msg sent, message_key <span class="token operator">=</span> fedml_0_2_dcc55da9-cb03-4548-a720-0d9aa8eeaac5
<span class="token punctuation">[</span>FedML-Client<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> @device-id-2<span class="token punctuation">]</span> <span class="token punctuation">[</span>Sun, 03 Jul <span class="token number">2022</span> <span class="token number">23</span>:20:22<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token punctuation">[</span>mqtt_s3_multi_clients_comm_manager.py:255:send_message<span class="token punctuation">]</span> mqtt_s3.send_message: to python client.
<span class="token punctuation">[</span>FedML-Client<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> @device-id-2<span class="token punctuation">]</span> <span class="token punctuation">[</span>Sun, 03 Jul <span class="token number">2022</span> <span class="token number">23</span>:20:22<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token punctuation">[</span>mqtt_manager.py:94:on_publish<span class="token punctuation">]</span> on_publish <span class="token assign-left variable">mid</span><span class="token operator">=</span><span class="token number">52</span>
<span class="token punctuation">[</span>FedML-Client<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> @device-id-2<span class="token punctuation">]</span> <span class="token punctuation">[</span>Sun, 03 Jul <span class="token number">2022</span> <span class="token number">23</span>:20:23<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token punctuation">[</span>mqtt_manager.py:84:on_message<span class="token punctuation">]</span> on_message<span class="token punctuation">(</span>fedml_0_0_2, b<span class="token string">&#39;{&quot;msg_type&quot;: 2, &quot;sender&quot;: 0, &quot;receiver&quot;: 2, &quot;model_params&quot;: &quot;fedml_0_0_2_1b5ac43c-adec-431c-b343-88e78ce96567&quot;, &quot;client_idx&quot;: &quot;794&quot;, &quot;client_os&quot;: &quot;PythonClient&quot;, &quot;model_params_url&quot;: &quot;https://fedml.s3.amazonaws.com/fedml_0_0_2_1b5ac43c-adec-431c-b343-88e78ce96567?AWSAccessKeyId=AKIAUAWARWF4SW36VYXP&amp;Signature=mQBjrZ%2BslzraI9MdabZM2DTdhGM%3D&amp;Expires=1657347623&quot;}&#39;</span><span class="token punctuation">)</span>
<span class="token punctuation">[</span>FedML-Client<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> @device-id-2<span class="token punctuation">]</span> <span class="token punctuation">[</span>Sun, 03 Jul <span class="token number">2022</span> <span class="token number">23</span>:20:23<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token punctuation">[</span>mqtt_s3_multi_clients_comm_manager.py:173:_on_message_impl<span class="token punctuation">]</span> mqtt_s3.on_message: use s3 pack, s3 message key fedml_0_0_2_1b5ac43c-adec-431c-b343-88e78ce96567
<span class="token punctuation">[</span>FedML-Client<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> @device-id-2<span class="token punctuation">]</span> <span class="token punctuation">[</span>Sun, 03 Jul <span class="token number">2022</span> <span class="token number">23</span>:20:23<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token punctuation">[</span>mqtt_s3_multi_clients_comm_manager.py:177:_on_message_impl<span class="token punctuation">]</span> mqtt_s3.on_message: from python client.
<span class="token punctuation">[</span>FedML-Client<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> @device-id-2<span class="token punctuation">]</span> <span class="token punctuation">[</span>Sun, 03 Jul <span class="token number">2022</span> <span class="token number">23</span>:20:23<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token punctuation">[</span>mqtt_s3_multi_clients_comm_manager.py:180:_on_message_impl<span class="token punctuation">]</span> mqtt_s3.on_message: model params length <span class="token number">2</span>
<span class="token punctuation">[</span>FedML-Client<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> @device-id-2<span class="token punctuation">]</span> <span class="token punctuation">[</span>Sun, 03 Jul <span class="token number">2022</span> <span class="token number">23</span>:20:23<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token punctuation">[</span>mqtt_s3_multi_clients_comm_manager.py:160:_notify<span class="token punctuation">]</span> mqtt_s3.notify: msg <span class="token builtin class-name">type</span> <span class="token operator">=</span> <span class="token number">2</span>
<span class="token punctuation">[</span>FedML-Client<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> @device-id-2<span class="token punctuation">]</span> <span class="token punctuation">[</span>Sun, 03 Jul <span class="token number">2022</span> <span class="token number">23</span>:20:23<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token punctuation">[</span>fedml_client_master_manager.py:136:handle_message_receive_model_from_server<span class="token punctuation">]</span> handle_message_receive_model_from_server.
<span class="token punctuation">[</span>FedML-Client<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> @device-id-2<span class="token punctuation">]</span> <span class="token punctuation">[</span>Sun, 03 Jul <span class="token number">2022</span> <span class="token number">23</span>:20:23<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token punctuation">[</span>fedml_client_master_manager.py:246:sync_process_group<span class="token punctuation">]</span> sending round number to pg
<span class="token punctuation">[</span>FedML-Client<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> @device-id-2<span class="token punctuation">]</span> <span class="token punctuation">[</span>Sun, 03 Jul <span class="token number">2022</span> <span class="token number">23</span>:20:23<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token punctuation">[</span>fedml_client_master_manager.py:253:sync_process_group<span class="token punctuation">]</span> round number <span class="token number">50</span> broadcasted to process group
<span class="token punctuation">[</span>FedML-Client<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> @device-id-2<span class="token punctuation">]</span> <span class="token punctuation">[</span>Sun, 03 Jul <span class="token number">2022</span> <span class="token number">23</span>:20:23<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token punctuation">[</span>fedml_client_master_manager.py:167:finish<span class="token punctuation">]</span> Training finished <span class="token keyword">for</span> master client rank <span class="token number">0</span> <span class="token keyword">in</span> silo <span class="token number">0</span>
<span class="token punctuation">[</span>FedML-Client<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> @device-id-2<span class="token punctuation">]</span> <span class="token punctuation">[</span>Sun, 03 Jul <span class="token number">2022</span> <span class="token number">23</span>:20:23<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token punctuation">[</span>fedml_trainer_dist_adapter.py:130:cleanup_pg<span class="token punctuation">]</span> Cleaningup process group <span class="token keyword">for</span> client <span class="token number">0</span> <span class="token keyword">in</span> silo <span class="token number">0</span>
<span class="token punctuation">[</span>FedML-Client<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> @device-id-2<span class="token punctuation">]</span> <span class="token punctuation">[</span>Sun, 03 Jul <span class="token number">2022</span> <span class="token number">23</span>:20:23<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token punctuation">[</span>client_manager.py:147:finish<span class="token punctuation">]</span> __finish client
<span class="token punctuation">[</span>FedML-Client<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> @device-id-2<span class="token punctuation">]</span> <span class="token punctuation">[</span>Sun, 03 Jul <span class="token number">2022</span> <span class="token number">23</span>:20:23<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token punctuation">[</span>mqtt_s3_multi_clients_comm_manager.py:278:stop_receive_message<span class="token punctuation">]</span> mqtt_s3.stop_receive_message: stopping<span class="token punctuation">..</span>.
<span class="token punctuation">[</span>FedML-Client<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> @device-id-2<span class="token punctuation">]</span> <span class="token punctuation">[</span>Sun, 03 Jul <span class="token number">2022</span> <span class="token number">23</span>:20:23<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token punctuation">[</span>mqtt_manager.py:98:on_disconnect<span class="token punctuation">]</span> on_disconnect <span class="token assign-left variable">code</span><span class="token operator">=</span><span class="token number">0</span>
<span class="token punctuation">[</span>FedML-Client<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> @device-id-2<span class="token punctuation">]</span> <span class="token punctuation">[</span>Sun, 03 Jul <span class="token number">2022</span> <span class="token number">23</span>:20:23<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token punctuation">[</span>mqtt_s3_multi_clients_comm_manager.py:140:on_disconnected<span class="token punctuation">]</span> mqtt_s3.on_disconnected
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="five-lines-of-apis" tabindex="-1"><a class="header-anchor" href="#five-lines-of-apis" aria-hidden="true">#</a> Five lines of APIs</h2><p>The step by step example using five lines of code locates at the following folder:</p><p><code>python/examples/cross_silo/mqtt_s3_fedavg_hierarchical_mnist_lr_example/step_by_step</code></p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token comment"># torch_client.py</span>
<span class="token keyword">import</span> fedml
<span class="token keyword">from</span> fedml<span class="token punctuation">.</span>cross_silo<span class="token punctuation">.</span>hierarchical <span class="token keyword">import</span> Client

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">&quot;__main__&quot;</span><span class="token punctuation">:</span>
    <span class="token comment"># init FedML framework</span>
    args <span class="token operator">=</span> fedml<span class="token punctuation">.</span>init<span class="token punctuation">(</span><span class="token punctuation">)</span>

    device <span class="token operator">=</span> fedml<span class="token punctuation">.</span>device<span class="token punctuation">.</span>get_device<span class="token punctuation">(</span>args<span class="token punctuation">)</span>

    <span class="token comment"># load data</span>
    dataset<span class="token punctuation">,</span> output_dim <span class="token operator">=</span> fedml<span class="token punctuation">.</span>data<span class="token punctuation">.</span>load<span class="token punctuation">(</span>args<span class="token punctuation">)</span>

    <span class="token comment"># load model</span>
    model <span class="token operator">=</span> fedml<span class="token punctuation">.</span>model<span class="token punctuation">.</span>create<span class="token punctuation">(</span>args<span class="token punctuation">,</span> output_dim<span class="token punctuation">)</span>

    <span class="token comment"># start training</span>
    client <span class="token operator">=</span> Client<span class="token punctuation">(</span>args<span class="token punctuation">,</span> device<span class="token punctuation">,</span> dataset<span class="token punctuation">,</span> model<span class="token punctuation">)</span>
    client<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="custom-data-and-model" tabindex="-1"><a class="header-anchor" href="#custom-data-and-model" aria-hidden="true">#</a> Custom data and model</h2><p>The custom data and model example locates at the following folder:</p><p><code>python/examples/cross_silo/mqtt_s3_fedavg_hierarchical_mnist_lr_example/custum_data_and_model</code></p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token comment"># torch_client.py</span>
<span class="token keyword">import</span> fedml
<span class="token keyword">import</span> torch
<span class="token keyword">from</span> fedml<span class="token punctuation">.</span>cross_silo<span class="token punctuation">.</span>hierarchical <span class="token keyword">import</span> Client
<span class="token keyword">from</span> fedml<span class="token punctuation">.</span>data<span class="token punctuation">.</span>MNIST<span class="token punctuation">.</span>data_loader <span class="token keyword">import</span> download_mnist<span class="token punctuation">,</span> load_partition_data_mnist
<span class="token keyword">from</span> fedml<span class="token punctuation">.</span>data<span class="token punctuation">.</span>data_loader_cross_silo <span class="token keyword">import</span> split_data_for_dist_trainers


<span class="token keyword">def</span> <span class="token function">load_data</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">:</span>
    n_dist_trainer <span class="token operator">=</span> args<span class="token punctuation">.</span>n_proc_in_silo
    download_mnist<span class="token punctuation">(</span>args<span class="token punctuation">.</span>data_cache_dir<span class="token punctuation">)</span>
    fedml<span class="token punctuation">.</span>logging<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">&quot;load_data. dataset_name = %s&quot;</span> <span class="token operator">%</span> args<span class="token punctuation">.</span>dataset<span class="token punctuation">)</span>

    <span class="token triple-quoted-string string">&quot;&quot;&quot;
    Please read through the data loader at to see how to customize the dataset for FedML framework.
    &quot;&quot;&quot;</span>
    <span class="token punctuation">(</span>
        client_num<span class="token punctuation">,</span>
        train_data_num<span class="token punctuation">,</span>
        test_data_num<span class="token punctuation">,</span>
        train_data_global<span class="token punctuation">,</span>
        test_data_global<span class="token punctuation">,</span>
        train_data_local_num_dict<span class="token punctuation">,</span>
        train_data_local_dict<span class="token punctuation">,</span>
        test_data_local_dict<span class="token punctuation">,</span>
        class_num<span class="token punctuation">,</span>
    <span class="token punctuation">)</span> <span class="token operator">=</span> load_partition_data_mnist<span class="token punctuation">(</span>
        args<span class="token punctuation">.</span>batch_size<span class="token punctuation">,</span>
        train_path<span class="token operator">=</span>args<span class="token punctuation">.</span>data_cache_dir <span class="token operator">+</span> <span class="token string">&quot;/MNIST/train&quot;</span><span class="token punctuation">,</span>
        test_path<span class="token operator">=</span>args<span class="token punctuation">.</span>data_cache_dir <span class="token operator">+</span> <span class="token string">&quot;/MNIST/test&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;
    For shallow NN or linear models, 
    we uniformly sample a fraction of clients each round (as the original FedAvg paper)
    &quot;&quot;&quot;</span>
    args<span class="token punctuation">.</span>client_num_in_total <span class="token operator">=</span> client_num
    dataset <span class="token operator">=</span> <span class="token punctuation">[</span>
        train_data_num<span class="token punctuation">,</span>
        test_data_num<span class="token punctuation">,</span>
        train_data_global<span class="token punctuation">,</span>
        test_data_global<span class="token punctuation">,</span>
        train_data_local_num_dict<span class="token punctuation">,</span>
        train_data_local_dict<span class="token punctuation">,</span>
        test_data_local_dict<span class="token punctuation">,</span>
        class_num<span class="token punctuation">,</span>
    <span class="token punctuation">]</span>

    <span class="token comment"># Split training data between distributed trainers</span>
    train_data_local_dict <span class="token operator">=</span> split_data_for_dist_trainers<span class="token punctuation">(</span>
        train_data_local_dict<span class="token punctuation">,</span> n_dist_trainer
    <span class="token punctuation">)</span>

    dataset <span class="token operator">=</span> <span class="token punctuation">[</span>
        train_data_num<span class="token punctuation">,</span>
        test_data_num<span class="token punctuation">,</span>
        train_data_global<span class="token punctuation">,</span>
        test_data_global<span class="token punctuation">,</span>
        train_data_local_num_dict<span class="token punctuation">,</span>
        train_data_local_dict<span class="token punctuation">,</span>
        test_data_local_dict<span class="token punctuation">,</span>
        class_num<span class="token punctuation">,</span>
    <span class="token punctuation">]</span>
    <span class="token keyword">return</span> dataset<span class="token punctuation">,</span> class_num


<span class="token keyword">class</span> <span class="token class-name">LogisticRegression</span><span class="token punctuation">(</span>torch<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> input_dim<span class="token punctuation">,</span> output_dim<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span>LogisticRegression<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>linear <span class="token operator">=</span> torch<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span>input_dim<span class="token punctuation">,</span> output_dim<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">:</span>
        outputs <span class="token operator">=</span> torch<span class="token punctuation">.</span>sigmoid<span class="token punctuation">(</span>self<span class="token punctuation">.</span>linear<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> outputs


<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">&quot;__main__&quot;</span><span class="token punctuation">:</span>
    <span class="token comment"># init FedML framework</span>
    args <span class="token operator">=</span> fedml<span class="token punctuation">.</span>init<span class="token punctuation">(</span><span class="token punctuation">)</span>

    device <span class="token operator">=</span> fedml<span class="token punctuation">.</span>device<span class="token punctuation">.</span>get_device<span class="token punctuation">(</span>args<span class="token punctuation">)</span>

    <span class="token comment"># load data</span>
    dataset<span class="token punctuation">,</span> output_dim <span class="token operator">=</span> load_data<span class="token punctuation">(</span>args<span class="token punctuation">)</span>

    <span class="token comment"># load model (the size of MNIST image is 28 x 28)</span>
    model <span class="token operator">=</span> LogisticRegression<span class="token punctuation">(</span><span class="token number">28</span> <span class="token operator">*</span> <span class="token number">28</span><span class="token punctuation">,</span> output_dim<span class="token punctuation">)</span>

    <span class="token comment"># start training</span>
    client <span class="token operator">=</span> Client<span class="token punctuation">(</span>args<span class="token punctuation">,</span> device<span class="token punctuation">,</span> dataset<span class="token punctuation">,</span> model<span class="token punctuation">)</span>
    client<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="source-code-architecture" tabindex="-1"><a class="header-anchor" href="#source-code-architecture" aria-hidden="true">#</a> Source code architecture</h2><p><img src="`+r+'" alt="img.png"></p><h2 id="a-better-user-experience-with-fedml-mlops-open-fedml-ai" tabindex="-1"><a class="header-anchor" href="#a-better-user-experience-with-fedml-mlops-open-fedml-ai" aria-hidden="true">#</a> A Better User-experience with FedML MLOps (open.fedml.ai)</h2><p>To reduce the difficulty and complexity of these CLI commands. We recommend you to use our MLOps (open.fedml.ai). FedML MLOps provides:</p><ul><li>Install Client Agent and Login</li><li>Inviting Collaborators and group management</li><li>Project Management</li><li>Experiment Tracking (visualizing training results)</li><li>monitoring device status</li><li>visualizing system performance (including profiling flow chart)</li><li>distributed logging</li><li>model serving</li></ul>',55);function m(_,v){const s=e("RouterLink");return p(),o("div",null,[k,c("p",null,[n("For more details, please refer to "),i(s,{to:"/es/mlops/user_guide.html"},{default:u(()=>[n("MLOps User Guide")]),_:1}),n(".")])])}const h=t(d,[["render",m],["__file","mqtt_s3_fedavg_hierarchical_mnist_lr_example.html.vue"]]);export{h as default};
