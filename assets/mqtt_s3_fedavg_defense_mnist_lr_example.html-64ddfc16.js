import{_ as o,r as a,o as c,c as l,a as s,b as n,d as e,w as i,e as u}from"./app-7ac5536a.js";const r={},d=s("h1",{id:"fedml-octopus-example-with-defense-mnist-logistic-regression",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#fedml-octopus-example-with-defense-mnist-logistic-regression","aria-hidden":"true"},"#"),n(" FedML Octopus - Example with Defense + MNIST + Logistic Regression")],-1),k={href:"https://github.com/FedML-AI/FedML/tree/master/python/examples/cross_silo/mqtt_s3_fedavg_defense_mnist_lr_example",target:"_blank",rel:"noopener noreferrer"},m=u(`<blockquote><p><strong>If you have multiple nodes, you should run the client script on each node</strong></p></blockquote><h2 id="one-line-api" tabindex="-1"><a class="header-anchor" href="#one-line-api" aria-hidden="true">#</a> One line API</h2><p><code>python/examples/cross_silo/mqtt_s3_fedavg_defense_mnist_lr_example/one_line</code></p><p>The highly encapsulated server and client API calls are shown as below:</p><p><code>run_server.sh</code> is as follows:</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token shebang important">#!/usr/bin/env bash</span>

python3 server/torch_server.py <span class="token parameter variable">--cf</span> config/fedml_config.yaml <span class="token parameter variable">--rank</span> <span class="token number">0</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>server/torch_server.py</code></p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">import</span> fedml


<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">&quot;__main__&quot;</span><span class="token punctuation">:</span>
    fedml<span class="token punctuation">.</span>run_cross_silo_server<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>run_client.sh</code></p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token shebang important">#!/usr/bin/env bash</span>
<span class="token assign-left variable">RANK</span><span class="token operator">=</span><span class="token variable">$1</span>
python3 torch_client.py <span class="token parameter variable">--cf</span> config/fedml_config.yaml <span class="token parameter variable">--rank</span> <span class="token variable">$RANK</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>client/torch_client.py</code></p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">import</span> fedml

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">&quot;__main__&quot;</span><span class="token punctuation">:</span>
    fedml<span class="token punctuation">.</span>run_cross_silo_client<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>At the client side, the client ID (a.k.a rank) starts from 1. Please also modify config/fedml_config.yaml, changing the <code>worker_num</code> the as the number of clients you plan to run.</p><p>At the server side, run the following script:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>bash run_server.sh
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>For client 1, run the following script:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>bash run_client.sh 1
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>For client 2, run the following script:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>bash run_client.sh 2
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>For client 3, run the following script:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>bash run_client.sh 3
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>For client 4, run the following script:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>bash run_client.sh 4
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><code>config/fedml_config.yaml</code> is shown below.</p><p>Here <code>common_args.training_type</code> is &quot;cross_silo&quot; type, and <code>train_args.client_id_list</code> needs to correspond to the client id in the client command line.</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">common_args</span><span class="token punctuation">:</span>
  <span class="token key atrule">training_type</span><span class="token punctuation">:</span> <span class="token string">&quot;cross_silo&quot;</span>
  <span class="token key atrule">scenario</span><span class="token punctuation">:</span> <span class="token string">&quot;horizontal&quot;</span>
  <span class="token key atrule">using_mlops</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
  <span class="token key atrule">random_seed</span><span class="token punctuation">:</span> <span class="token number">0</span>
  <span class="token key atrule">config_version</span><span class="token punctuation">:</span> release

<span class="token key atrule">environment_args</span><span class="token punctuation">:</span>
  <span class="token key atrule">bootstrap</span><span class="token punctuation">:</span> config/bootstrap.sh

<span class="token key atrule">data_args</span><span class="token punctuation">:</span>
  <span class="token key atrule">dataset</span><span class="token punctuation">:</span> <span class="token string">&quot;mnist&quot;</span>
  <span class="token key atrule">data_cache_dir</span><span class="token punctuation">:</span> ~/fedml_data
  <span class="token key atrule">partition_method</span><span class="token punctuation">:</span> <span class="token string">&quot;hetero&quot;</span>
  <span class="token key atrule">partition_alpha</span><span class="token punctuation">:</span> <span class="token number">0.5</span>

<span class="token key atrule">model_args</span><span class="token punctuation">:</span>
  <span class="token key atrule">model</span><span class="token punctuation">:</span> <span class="token string">&quot;lr&quot;</span>
  <span class="token key atrule">model_file_cache_folder</span><span class="token punctuation">:</span> <span class="token string">&quot;./model_file_cache&quot;</span> <span class="token comment"># will be filled by the server automatically</span>
  <span class="token key atrule">global_model_file_path</span><span class="token punctuation">:</span> <span class="token string">&quot;./model_file_cache/global_model.pt&quot;</span>

<span class="token key atrule">train_args</span><span class="token punctuation">:</span>
  <span class="token key atrule">federated_optimizer</span><span class="token punctuation">:</span> <span class="token string">&quot;FedAvg&quot;</span>
  <span class="token comment"># for CLI running, this can be None; in MLOps deployment, \`client_id_list\` will be replaced with real-time selected devices</span>
  <span class="token key atrule">client_id_list</span><span class="token punctuation">:</span>
  <span class="token key atrule">client_num_in_total</span><span class="token punctuation">:</span> <span class="token number">4</span>
  <span class="token key atrule">client_num_per_round</span><span class="token punctuation">:</span> <span class="token number">4</span>
  <span class="token key atrule">comm_round</span><span class="token punctuation">:</span> <span class="token number">10</span>
  <span class="token key atrule">epochs</span><span class="token punctuation">:</span> <span class="token number">1</span>
  <span class="token key atrule">batch_size</span><span class="token punctuation">:</span> <span class="token number">10</span>
  <span class="token key atrule">client_optimizer</span><span class="token punctuation">:</span> sgd
  <span class="token key atrule">learning_rate</span><span class="token punctuation">:</span> <span class="token number">0.03</span>
  <span class="token key atrule">weight_decay</span><span class="token punctuation">:</span> <span class="token number">0.001</span>

<span class="token key atrule">validation_args</span><span class="token punctuation">:</span>
  <span class="token key atrule">frequency_of_the_test</span><span class="token punctuation">:</span> <span class="token number">1</span>

<span class="token key atrule">device_args</span><span class="token punctuation">:</span>
  <span class="token key atrule">using_gpu</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
  <span class="token key atrule">gpu_mapping_file</span><span class="token punctuation">:</span> config/gpu_mapping.yaml
  <span class="token key atrule">gpu_mapping_key</span><span class="token punctuation">:</span> mapping_default

<span class="token key atrule">comm_args</span><span class="token punctuation">:</span>
  <span class="token key atrule">backend</span><span class="token punctuation">:</span> <span class="token string">&quot;MQTT_S3&quot;</span>
  <span class="token key atrule">mqtt_config_path</span><span class="token punctuation">:</span>
  <span class="token key atrule">s3_config_path</span><span class="token punctuation">:</span>
  <span class="token key atrule">grpc_ipconfig_path</span><span class="token punctuation">:</span> ./config/grpc_ipconfig.csv

<span class="token key atrule">tracking_args</span><span class="token punctuation">:</span>
   <span class="token comment"># When running on MLOps platform(open.fedml.ai), the default log path is at ~/fedml-client/fedml/logs/ and ~/fedml-server/fedml/logs/</span>
  <span class="token key atrule">enable_wandb</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
  <span class="token key atrule">wandb_key</span><span class="token punctuation">:</span> ee0b5f53d949c84cee7decbe7a629e63fb2f8408
  <span class="token key atrule">wandb_project</span><span class="token punctuation">:</span> fedml
  <span class="token key atrule">wandb_name</span><span class="token punctuation">:</span> fedml_torch_fedavg_mnist_lr

<span class="token key atrule">defense_args</span><span class="token punctuation">:</span>
  <span class="token key atrule">enable_defense</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
  <span class="token key atrule">defense_type</span><span class="token punctuation">:</span> foolsgold
  <span class="token key atrule">use_memory</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="training-results" tabindex="-1"><a class="header-anchor" href="#training-results" aria-hidden="true">#</a> Training Results</h3><p>At the end of training, the server window will see the following output:</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>FedML-Server<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> @device-id-0<span class="token punctuation">]</span> <span class="token punctuation">[</span>Sat, <span class="token number">27</span> Aug <span class="token number">2022</span> <span class="token number">23</span>:23:46<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token punctuation">[</span>fedml_server_manager.py:200:send_message_finish<span class="token punctuation">]</span>  <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>send cleanup message to <span class="token assign-left variable">879</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>
<span class="token punctuation">[</span>FedML-Server<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> @device-id-0<span class="token punctuation">]</span> <span class="token punctuation">[</span>Sat, <span class="token number">27</span> Aug <span class="token number">2022</span> <span class="token number">23</span>:23:46<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token punctuation">[</span>mqtt_s3_multi_clients_comm_manager.py:230:send_message<span class="token punctuation">]</span> mqtt_s3.send_message: msg topic <span class="token operator">=</span> fedml_123_0_3
<span class="token punctuation">[</span>FedML-Server<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> @device-id-0<span class="token punctuation">]</span> <span class="token punctuation">[</span>Sat, <span class="token number">27</span> Aug <span class="token number">2022</span> <span class="token number">23</span>:23:46<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token punctuation">[</span>mqtt_s3_multi_clients_comm_manager.py:255:send_message<span class="token punctuation">]</span> mqtt_s3.send_message: MQTT msg sent
<span class="token punctuation">[</span>FedML-Server<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> @device-id-0<span class="token punctuation">]</span> <span class="token punctuation">[</span>Sat, <span class="token number">27</span> Aug <span class="token number">2022</span> <span class="token number">23</span>:23:47<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token punctuation">[</span>fedml_server_manager.py:200:send_message_finish<span class="token punctuation">]</span>  <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>send cleanup message to <span class="token assign-left variable">57</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>
<span class="token punctuation">[</span>FedML-Server<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> @device-id-0<span class="token punctuation">]</span> <span class="token punctuation">[</span>Sat, <span class="token number">27</span> Aug <span class="token number">2022</span> <span class="token number">23</span>:23:47<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token punctuation">[</span>mqtt_s3_multi_clients_comm_manager.py:230:send_message<span class="token punctuation">]</span> mqtt_s3.send_message: msg topic <span class="token operator">=</span> fedml_123_0_4
<span class="token punctuation">[</span>FedML-Server<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> @device-id-0<span class="token punctuation">]</span> <span class="token punctuation">[</span>Sat, <span class="token number">27</span> Aug <span class="token number">2022</span> <span class="token number">23</span>:23:47<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token punctuation">[</span>mqtt_s3_multi_clients_comm_manager.py:255:send_message<span class="token punctuation">]</span> mqtt_s3.send_message: MQTT msg sent
<span class="token punctuation">[</span>FedML-Server<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> @device-id-0<span class="token punctuation">]</span> <span class="token punctuation">[</span>Sat, <span class="token number">27</span> Aug <span class="token number">2022</span> <span class="token number">23</span>:23:48<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token punctuation">[</span>fedml_server_manager.py:200:send_message_finish<span class="token punctuation">]</span>  <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>send cleanup message to <span class="token assign-left variable">496</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>
<span class="token punctuation">[</span>FedML-Server<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> @device-id-0<span class="token punctuation">]</span> <span class="token punctuation">[</span>Sat, <span class="token number">27</span> Aug <span class="token number">2022</span> <span class="token number">23</span>:23:51<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token punctuation">[</span>fedml_comm_manager.py:62:finish<span class="token punctuation">]</span> __finish
<span class="token punctuation">[</span>FedML-Server<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> @device-id-0<span class="token punctuation">]</span> <span class="token punctuation">[</span>Sat, <span class="token number">27</span> Aug <span class="token number">2022</span> <span class="token number">23</span>:23:51<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token punctuation">[</span>mqtt_s3_multi_clients_comm_manager.py:296:stop_receive_message<span class="token punctuation">]</span> mqtt_s3.stop_receive_message: stopping<span class="token punctuation">..</span>.
<span class="token punctuation">[</span>FedML-Server<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> @device-id-0<span class="token punctuation">]</span> <span class="token punctuation">[</span>Sat, <span class="token number">27</span> Aug <span class="token number">2022</span> <span class="token number">23</span>:23:51<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token punctuation">[</span>fedml_comm_manager.py:28:run<span class="token punctuation">]</span> finished<span class="token punctuation">..</span>.
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>At the end of training, each client window will see the following output:</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>FedML-Client<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> @device-id-1<span class="token punctuation">]</span> <span class="token punctuation">[</span>Sat, <span class="token number">27</span> Aug <span class="token number">2022</span> <span class="token number">23</span>:23:51<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token punctuation">[</span>mqtt_s3_multi_clients_comm_manager.py:191:_on_message_impl<span class="token punctuation">]</span> mqtt_s3.on_message: use s3 pack, s3 message key fedml_123_0_1_d7361ad6-a063-48be-b08a-ef0aa3f9ba48
<span class="token punctuation">[</span>FedML-Client<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> @device-id-1<span class="token punctuation">]</span> <span class="token punctuation">[</span>Sat, <span class="token number">27</span> Aug <span class="token number">2022</span> <span class="token number">23</span>:23:51<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token punctuation">[</span>mqtt_s3_multi_clients_comm_manager.py:197:_on_message_impl<span class="token punctuation">]</span> mqtt_s3.on_message: model params length <span class="token number">2</span>
<span class="token punctuation">[</span>FedML-Client<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> @device-id-1<span class="token punctuation">]</span> <span class="token punctuation">[</span>Sat, <span class="token number">27</span> Aug <span class="token number">2022</span> <span class="token number">23</span>:23:51<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token punctuation">[</span>mqtt_s3_multi_clients_comm_manager.py:178:_notify<span class="token punctuation">]</span> mqtt_s3.notify: msg <span class="token builtin class-name">type</span> <span class="token operator">=</span> <span class="token number">2</span>
<span class="token punctuation">[</span>FedML-Client<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> @device-id-1<span class="token punctuation">]</span> <span class="token punctuation">[</span>Sat, <span class="token number">27</span> Aug <span class="token number">2022</span> <span class="token number">23</span>:23:51<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token punctuation">[</span>fedml_comm_manager.py:34:receive_message<span class="token punctuation">]</span> receive_message. msg_type <span class="token operator">=</span> <span class="token number">2</span>, sender_id <span class="token operator">=</span> <span class="token number">0</span>, receiver_id <span class="token operator">=</span> <span class="token number">1</span>
<span class="token punctuation">[</span>FedML-Client<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> @device-id-1<span class="token punctuation">]</span> <span class="token punctuation">[</span>Sat, <span class="token number">27</span> Aug <span class="token number">2022</span> <span class="token number">23</span>:23:51<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token punctuation">[</span>fedml_client_master_manager.py:81:handle_message_receive_model_from_server<span class="token punctuation">]</span> handle_message_receive_model_from_server.
<span class="token punctuation">[</span>FedML-Client<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> @device-id-1<span class="token punctuation">]</span> <span class="token punctuation">[</span>Sat, <span class="token number">27</span> Aug <span class="token number">2022</span> <span class="token number">23</span>:23:51<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token punctuation">[</span>mqtt_s3_multi_clients_comm_manager.py:204:_on_message_impl<span class="token punctuation">]</span> mqtt_s3.on_message: not use s3 pack
<span class="token punctuation">[</span>FedML-Client<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> @device-id-1<span class="token punctuation">]</span> <span class="token punctuation">[</span>Sat, <span class="token number">27</span> Aug <span class="token number">2022</span> <span class="token number">23</span>:23:51<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token punctuation">[</span>mqtt_s3_multi_clients_comm_manager.py:178:_notify<span class="token punctuation">]</span> mqtt_s3.notify: msg <span class="token builtin class-name">type</span> <span class="token operator">=</span> <span class="token number">7</span>
<span class="token punctuation">[</span>FedML-Client<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> @device-id-1<span class="token punctuation">]</span> <span class="token punctuation">[</span>Sat, <span class="token number">27</span> Aug <span class="token number">2022</span> <span class="token number">23</span>:23:51<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token punctuation">[</span>fedml_comm_manager.py:34:receive_message<span class="token punctuation">]</span> receive_message. msg_type <span class="token operator">=</span> <span class="token number">7</span>, sender_id <span class="token operator">=</span> <span class="token number">0</span>, receiver_id <span class="token operator">=</span> <span class="token number">1</span>
<span class="token punctuation">[</span>FedML-Client<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> @device-id-1<span class="token punctuation">]</span> <span class="token punctuation">[</span>Sat, <span class="token number">27</span> Aug <span class="token number">2022</span> <span class="token number">23</span>:23:51<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token punctuation">[</span>fedml_client_master_manager.py:98:handle_message_finish<span class="token punctuation">]</span>  <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>cleanup <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>
<span class="token punctuation">[</span>FedML-Client<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> @device-id-1<span class="token punctuation">]</span> <span class="token punctuation">[</span>Sat, <span class="token number">27</span> Aug <span class="token number">2022</span> <span class="token number">23</span>:23:51<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token punctuation">[</span>fedml_comm_manager.py:62:finish<span class="token punctuation">]</span> __finish
<span class="token punctuation">[</span>FedML-Client<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> @device-id-1<span class="token punctuation">]</span> <span class="token punctuation">[</span>Sat, <span class="token number">27</span> Aug <span class="token number">2022</span> <span class="token number">23</span>:23:51<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token punctuation">[</span>mqtt_s3_multi_clients_comm_manager.py:296:stop_receive_message<span class="token punctuation">]</span> mqtt_s3.stop_receive_message: stopping<span class="token punctuation">..</span>.
<span class="token punctuation">[</span>FedML-Client<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> @device-id-1<span class="token punctuation">]</span> <span class="token punctuation">[</span>Sat, <span class="token number">27</span> Aug <span class="token number">2022</span> <span class="token number">23</span>:23:51<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token punctuation">[</span>fedml_comm_manager.py:28:run<span class="token punctuation">]</span> finished<span class="token punctuation">..</span>.
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="five-lines-of-apis" tabindex="-1"><a class="header-anchor" href="#five-lines-of-apis" aria-hidden="true">#</a> Five lines of APIs</h2><p><code>torch_client.py</code></p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">import</span> fedml
<span class="token keyword">from</span> fedml<span class="token punctuation">.</span>cross_silo <span class="token keyword">import</span> Client

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">&quot;__main__&quot;</span><span class="token punctuation">:</span>
    args <span class="token operator">=</span> fedml<span class="token punctuation">.</span>init<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment"># init device</span>
    device <span class="token operator">=</span> fedml<span class="token punctuation">.</span>device<span class="token punctuation">.</span>get_device<span class="token punctuation">(</span>args<span class="token punctuation">)</span>

    <span class="token comment"># load data</span>
    dataset<span class="token punctuation">,</span> output_dim <span class="token operator">=</span> fedml<span class="token punctuation">.</span>data<span class="token punctuation">.</span>load<span class="token punctuation">(</span>args<span class="token punctuation">)</span>

    <span class="token comment"># load model</span>
    model <span class="token operator">=</span> fedml<span class="token punctuation">.</span>model<span class="token punctuation">.</span>create<span class="token punctuation">(</span>args<span class="token punctuation">,</span> output_dim<span class="token punctuation">)</span>

    <span class="token comment"># start training</span>
    client <span class="token operator">=</span> Client<span class="token punctuation">(</span>args<span class="token punctuation">,</span> device<span class="token punctuation">,</span> dataset<span class="token punctuation">,</span> model<span class="token punctuation">)</span>
    client<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="custom-data-and-model" tabindex="-1"><a class="header-anchor" href="#custom-data-and-model" aria-hidden="true">#</a> Custom data and model</h2><p>The custom data and model example locates at the following folder:</p><p><code>python/examples/cross_silo/mqtt_s3_fedavg_defense_mnist_lr_example/custum_data_and_model</code></p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">load_data</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">:</span>
    download_mnist<span class="token punctuation">(</span>args<span class="token punctuation">.</span>data_cache_dir<span class="token punctuation">)</span>
    fedml<span class="token punctuation">.</span>logger<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">&quot;load_data. dataset_name = %s&quot;</span> <span class="token operator">%</span> args<span class="token punctuation">.</span>dataset<span class="token punctuation">)</span>

    <span class="token triple-quoted-string string">&quot;&quot;&quot;
    Please read through the data loader at to see how to customize the dataset for FedML framework.
    &quot;&quot;&quot;</span>
    <span class="token punctuation">(</span>
        client_num<span class="token punctuation">,</span>
        train_data_num<span class="token punctuation">,</span>
        test_data_num<span class="token punctuation">,</span>
        train_data_global<span class="token punctuation">,</span>
        test_data_global<span class="token punctuation">,</span>
        train_data_local_num_dict<span class="token punctuation">,</span>
        train_data_local_dict<span class="token punctuation">,</span>
        test_data_local_dict<span class="token punctuation">,</span>
        class_num<span class="token punctuation">,</span>
    <span class="token punctuation">)</span> <span class="token operator">=</span> load_partition_data_mnist<span class="token punctuation">(</span>
        args<span class="token punctuation">.</span>batch_size<span class="token punctuation">,</span>
        train_path<span class="token operator">=</span>args<span class="token punctuation">.</span>data_cache_dir <span class="token operator">+</span> <span class="token string">&quot;MNIST/train&quot;</span><span class="token punctuation">,</span>
        test_path<span class="token operator">=</span>args<span class="token punctuation">.</span>data_cache_dir <span class="token operator">+</span> <span class="token string">&quot;MNIST/test&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;
    For shallow NN or linear models, 
    we uniformly sample a fraction of clients each round (as the original FedAvg paper)
    &quot;&quot;&quot;</span>
    args<span class="token punctuation">.</span>client_num_in_total <span class="token operator">=</span> client_num
    dataset <span class="token operator">=</span> <span class="token punctuation">[</span>
        train_data_num<span class="token punctuation">,</span>
        test_data_num<span class="token punctuation">,</span>
        train_data_global<span class="token punctuation">,</span>
        test_data_global<span class="token punctuation">,</span>
        train_data_local_num_dict<span class="token punctuation">,</span>
        train_data_local_dict<span class="token punctuation">,</span>
        test_data_local_dict<span class="token punctuation">,</span>
        class_num<span class="token punctuation">,</span>
    <span class="token punctuation">]</span>
    <span class="token keyword">return</span> dataset<span class="token punctuation">,</span> class_num


<span class="token keyword">class</span> <span class="token class-name">LogisticRegression</span><span class="token punctuation">(</span>torch<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> input_dim<span class="token punctuation">,</span> output_dim<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span>LogisticRegression<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>linear <span class="token operator">=</span> torch<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span>input_dim<span class="token punctuation">,</span> output_dim<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">:</span>
        outputs <span class="token operator">=</span> torch<span class="token punctuation">.</span>sigmoid<span class="token punctuation">(</span>self<span class="token punctuation">.</span>linear<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> outputs
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">&quot;__main__&quot;</span><span class="token punctuation">:</span>
    <span class="token comment"># init FedML framework</span>
    args <span class="token operator">=</span> fedml<span class="token punctuation">.</span>init<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment"># init device</span>
    device <span class="token operator">=</span> fedml<span class="token punctuation">.</span>device<span class="token punctuation">.</span>get_device<span class="token punctuation">(</span>args<span class="token punctuation">)</span>

    <span class="token comment"># load data</span>
    dataset<span class="token punctuation">,</span> output_dim <span class="token operator">=</span> load_data<span class="token punctuation">(</span>args<span class="token punctuation">)</span>

    <span class="token comment"># load model (the size of MNIST image is 28 x 28)</span>
    model <span class="token operator">=</span> LogisticRegression<span class="token punctuation">(</span><span class="token number">28</span> <span class="token operator">*</span> <span class="token number">28</span><span class="token punctuation">,</span> output_dim<span class="token punctuation">)</span>

    <span class="token comment"># start training</span>
    client <span class="token operator">=</span> Client<span class="token punctuation">(</span>args<span class="token punctuation">,</span> device<span class="token punctuation">,</span> dataset<span class="token punctuation">,</span> model<span class="token punctuation">)</span>
    client<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="a-better-user-experience-with-fedml-mlops-open-fedml-ai" tabindex="-1"><a class="header-anchor" href="#a-better-user-experience-with-fedml-mlops-open-fedml-ai" aria-hidden="true">#</a> A Better User-experience with FedML MLOps (open.fedml.ai)</h2><p>To reduce the difficulty and complexity of these CLI commands. We recommend you to use our MLOps (open.fedml.ai). FedML MLOps provides:</p><ul><li>Install Client Agent and Login</li><li>Inviting Collaborators and group management</li><li>Project Management</li><li>Experiment Tracking (visualizing training results)</li><li>monitoring device status</li><li>visualizing system performance (including profiling flow chart)</li><li>distributed logging</li><li>model serving</li></ul>`,42);function v(_,b){const t=a("ExternalLinkIcon"),p=a("RouterLink");return c(),l("div",null,[d,s("p",null,[n("This example illustrates how to add defenses on cross-silo federated learning with FedML Octopus. The source code locates at "),s("a",k,[n("https://github.com/FedML-AI/FedML/tree/master/python/examples/cross_silo/mqtt_s3_fedavg_defense_mnist_lr_example"),e(t)]),n(". We use FoolsGold defense for example.")]),m,s("p",null,[n("For more details, please refer to "),e(p,{to:"/cn/mlops/user_guide.html"},{default:i(()=>[n("MLOps User Guide")]),_:1}),n(".")])])}const h=o(r,[["render",v],["__file","mqtt_s3_fedavg_defense_mnist_lr_example.html.vue"]]);export{h as default};
