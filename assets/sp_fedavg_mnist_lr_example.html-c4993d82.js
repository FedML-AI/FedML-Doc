import{_ as p,r as o,o as c,c as l,a as s,b as n,d as e,e as t}from"./app-7ac5536a.js";const i={},r=s("h1",{id:"simulation-with-a-single-process-standalone",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#simulation-with-a-single-process-standalone","aria-hidden":"true"},"#"),n(" Simulation with a Single Process (Standalone)")],-1),u=s("p",null,"Simulating FL using a single process in your personal laptop or server. This is helpful when researchers hope to try a quick algorithmic idea in small synthetic datasets (MNIST, Shakespeare, etc.) and small models (ResNet-18, Logistic Regression, etc.).",-1),k=s("strong",null,"using a single process",-1),d={href:"https://github.com/FedML-AI/FedML/tree/master/python/examples/simulation/sp_fedavg_mnist_lr_example",target:"_blank",rel:"noopener noreferrer"},m=t(`<h2 id="one-line-api" tabindex="-1"><a class="header-anchor" href="#one-line-api" aria-hidden="true">#</a> One line API</h2><p>In this section, we present how to implement a stand-alone simulated version of the FedAvg algorithm running on MNIST dataset using FedML with a single line of code.</p><h3 id="step-1-preparation" tabindex="-1"><a class="header-anchor" href="#step-1-preparation" aria-hidden="true">#</a> <strong>Step 1. preparation</strong></h3><p>First we should create a new python environment with conda</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>conda create <span class="token parameter variable">-n</span> fedml python
conda activate fedml
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>Then we should make sure that we have completed the installation of fedml and the preparation of the dataset.</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>python <span class="token parameter variable">-m</span> pip <span class="token function">install</span> <span class="token parameter variable">--upgrade</span> pip
python <span class="token parameter variable">-m</span> pip <span class="token function">install</span> fedml
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>The dataset is provided in this case, if you need to use other datasets you can refer to the detailed steps in <strong><a href="../../starter/getting_started">Getting Started</a></strong>.</p><h3 id="step-2-setup-parameters" tabindex="-1"><a class="header-anchor" href="#step-2-setup-parameters" aria-hidden="true">#</a> Step 2. setup Parameters</h3><p>Once we have installed the dependent packages, we can set the parameters by editing the <code>fedml_config.yaml</code> as shown below, which defines the parameters <code>common_args</code>, <code>data_args</code>, <code>model_args</code>, <code>train_args</code>, <code>validation_args</code>, <code>device_args</code>, <code>tracking_args</code> and <code>tracking_args</code>.</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">common_args</span><span class="token punctuation">:</span>
  <span class="token key atrule">training_type</span><span class="token punctuation">:</span> <span class="token string">&quot;simulation&quot;</span>
  <span class="token key atrule">random_seed</span><span class="token punctuation">:</span> <span class="token number">0</span>

<span class="token key atrule">data_args</span><span class="token punctuation">:</span>
  <span class="token key atrule">dataset</span><span class="token punctuation">:</span> <span class="token string">&quot;mnist&quot;</span>
  <span class="token key atrule">data_cache_dir</span><span class="token punctuation">:</span> <span class="token string">&quot;../../../data/mnist&quot;</span>
  <span class="token key atrule">partition_method</span><span class="token punctuation">:</span> <span class="token string">&quot;hetero&quot;</span>
  <span class="token key atrule">partition_alpha</span><span class="token punctuation">:</span> <span class="token number">0.5</span>

<span class="token key atrule">model_args</span><span class="token punctuation">:</span>
  <span class="token key atrule">model</span><span class="token punctuation">:</span> <span class="token string">&quot;lr&quot;</span>

<span class="token key atrule">train_args</span><span class="token punctuation">:</span>
  <span class="token key atrule">federated_optimizer</span><span class="token punctuation">:</span> <span class="token string">&quot;FedAvg&quot;</span>
  <span class="token key atrule">client_id_list</span><span class="token punctuation">:</span> <span class="token string">&quot;[]&quot;</span>
  <span class="token key atrule">client_num_in_total</span><span class="token punctuation">:</span> <span class="token number">1000</span>
  <span class="token key atrule">client_num_per_round</span><span class="token punctuation">:</span> <span class="token number">10</span>
  <span class="token key atrule">comm_round</span><span class="token punctuation">:</span> <span class="token number">200</span>
  <span class="token key atrule">epochs</span><span class="token punctuation">:</span> <span class="token number">1</span>
  <span class="token key atrule">batch_size</span><span class="token punctuation">:</span> <span class="token number">10</span>
  <span class="token key atrule">client_optimizer</span><span class="token punctuation">:</span> sgd
  <span class="token key atrule">learning_rate</span><span class="token punctuation">:</span> <span class="token number">0.03</span>
  <span class="token key atrule">weight_decay</span><span class="token punctuation">:</span> <span class="token number">0.001</span>

<span class="token key atrule">validation_args</span><span class="token punctuation">:</span>
  <span class="token key atrule">frequency_of_the_test</span><span class="token punctuation">:</span> <span class="token number">5</span>

<span class="token key atrule">device_args</span><span class="token punctuation">:</span>
  <span class="token key atrule">using_gpu</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
  <span class="token key atrule">gpu_id</span><span class="token punctuation">:</span> <span class="token number">0</span>

<span class="token key atrule">comm_args</span><span class="token punctuation">:</span>
  <span class="token key atrule">backend</span><span class="token punctuation">:</span> <span class="token string">&quot;sp&quot;</span>

<span class="token key atrule">tracking_args</span><span class="token punctuation">:</span>
  <span class="token key atrule">log_file_dir</span><span class="token punctuation">:</span> ./log
  <span class="token key atrule">enable_wandb</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
  <span class="token key atrule">wandb_key</span><span class="token punctuation">:</span> ee0b5f53d949c84cee7decbe7a629e63fb2f8408
  <span class="token key atrule">wandb_entity</span><span class="token punctuation">:</span> fedml<span class="token punctuation">-</span>ai
  <span class="token key atrule">wandb_project</span><span class="token punctuation">:</span> simulation
  <span class="token key atrule">run_name</span><span class="token punctuation">:</span> fedml_torch_fedavg_mnist_lr
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,11),b=s("code",null,"common_args.training_type",-1),v=s("strong",null,'"simulation"',-1),_=s("code",null,"data_args.dataset",-1),h=s("strong",null,'"mnist"',-1),g=s("code",null,"model_args.model",-1),f=s("strong",null,'"lr"',-1),y=s("strong",null,"LogisticRegression (lr)",-1),w={href:"https://github.com/FedML-AI/FedML/tree/master/python/examples",target:"_blank",rel:"noopener noreferrer"},F=t(`<h3 id="step-3-training" tabindex="-1"><a class="header-anchor" href="#step-3-training" aria-hidden="true">#</a> Step 3. training</h3><p>Now that we have configured all the dependent environments, we can quickly implement the training of a federation learning model on the MNIST dataset for a single machine simulation with the following line of code:</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>python torch_fedavg_mnist_lr_one_line_example.py <span class="token parameter variable">--cf</span> fedml_config.yaml
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>The <code>--cf fedml_config.yaml</code> specifies the corresponding parameter settings file.</p><p>We can see the following output when the program is just running:</p><div class="language-log line-numbers-mode" data-ext="log"><pre class="language-log"><code><span class="token punctuation">[</span><span class="token date number">2022-04-21</span> <span class="token time number">15:42:34,124</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token level info keyword">INFO</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>device<span class="token punctuation">.</span>py<span class="token operator">:</span><span class="token number">14</span><span class="token operator">:</span>get_device<span class="token punctuation">]</span> device <span class="token operator">=</span> cpu
<span class="token punctuation">[</span><span class="token date number">2022-04-21</span> <span class="token time number">15:42:34,124</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token level info keyword">INFO</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>data_loader<span class="token punctuation">.</span>py<span class="token operator">:</span><span class="token number">19</span><span class="token operator">:</span>download_mnist<span class="token punctuation">]</span> <span class="token file-path string">./MNIST.zip</span>
<span class="token number">100</span><span class="token operator">%</span> <span class="token punctuation">[</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">]</span> <span class="token number">128363870</span> <span class="token operator">/</span> <span class="token number">128363870</span><span class="token punctuation">[</span><span class="token date number">2022-04-21</span> <span class="token time number">15:44:10,003</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token level info keyword">INFO</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>data_loader<span class="token punctuation">.</span>py<span class="token operator">:</span><span class="token number">63</span><span class="token operator">:</span>load_for_simulation<span class="token punctuation">]</span> load_data<span class="token punctuation">.</span> dataset_name <span class="token operator">=</span> mnist
<span class="token punctuation">[</span><span class="token date number">2022-04-21</span> <span class="token time number">15:45:25,817</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token level info keyword">INFO</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>model_hub<span class="token punctuation">.</span>py<span class="token operator">:</span><span class="token number">14</span><span class="token operator">:</span>create<span class="token punctuation">]</span> create_model<span class="token punctuation">.</span> model_name <span class="token operator">=</span> lr<span class="token punctuation">,</span> output_dim <span class="token operator">=</span> <span class="token number">10</span>
<span class="token punctuation">[</span><span class="token date number">2022-04-21</span> <span class="token time number">15:45:25,818</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token level info keyword">INFO</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>model_hub<span class="token punctuation">.</span>py<span class="token operator">:</span><span class="token number">17</span><span class="token operator">:</span>create<span class="token punctuation">]</span> LogisticRegression <span class="token operator">+</span> MNIST
<span class="token punctuation">[</span><span class="token date number">2022-04-21</span> <span class="token time number">15:45:25,860</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token level info keyword">INFO</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>fedavg_api<span class="token punctuation">.</span>py<span class="token operator">:</span><span class="token number">41</span><span class="token operator">:</span>__init__<span class="token punctuation">]</span> model <span class="token operator">=</span> LogisticRegression<span class="token operator">(</span>
  <span class="token operator">(</span>linear<span class="token operator">)</span><span class="token operator">:</span> Linear<span class="token operator">(</span>in_features<span class="token operator">=</span><span class="token number">784</span><span class="token punctuation">,</span> out_features<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">,</span> bias<span class="token operator">=</span><span class="token boolean">True</span><span class="token operator">)</span>
<span class="token operator">)</span>
<span class="token punctuation">[</span><span class="token date number">2022-04-21</span> <span class="token time number">15:45:25,861</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token level info keyword">INFO</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>fedavg_api<span class="token punctuation">.</span>py<span class="token operator">:</span><span class="token number">50</span><span class="token operator">:</span>__init__<span class="token punctuation">]</span> self<span class="token punctuation">.</span>model_trainer <span class="token operator">=</span> <span class="token operator">&lt;</span>fedml<span class="token punctuation">.</span>simulation<span class="token punctuation">.</span>fedavg<span class="token punctuation">.</span>my_model_trainer_classification<span class="token punctuation">.</span>MyModelTrainer object at <span class="token number">0x000001CF758D8F88</span><span class="token operator">&gt;</span>
<span class="token punctuation">[</span><span class="token date number">2022-04-21</span> <span class="token time number">15:45:25,867</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token level info keyword">INFO</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>fedavg_api<span class="token punctuation">.</span>py<span class="token operator">:</span><span class="token number">81</span><span class="token operator">:</span>train<span class="token punctuation">]</span> self<span class="token punctuation">.</span>model_trainer <span class="token operator">=</span> <span class="token operator">&lt;</span>fedml<span class="token punctuation">.</span>simulation<span class="token punctuation">.</span>fedavg<span class="token punctuation">.</span>my_model_trainer_classification<span class="token punctuation">.</span>MyModelTrainer object at <span class="token number">0x000001CF758D8F88</span><span class="token operator">&gt;</span>
<span class="token punctuation">[</span><span class="token date number">2022-04-21</span> <span class="token time number">15:45:26,046</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token level info keyword">INFO</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>my_model_trainer_classification<span class="token punctuation">.</span>py<span class="token operator">:</span><span class="token number">52</span><span class="token operator">:</span>train<span class="token punctuation">]</span> <span class="token property">Update Epoch:</span> <span class="token number">0</span> <span class="token punctuation">[</span><span class="token number">10</span><span class="token operator">/</span><span class="token number">20</span> <span class="token operator">(</span><span class="token number">50</span><span class="token operator">%</span><span class="token operator">)</span><span class="token punctuation">]</span>   <span class="token property">Loss:</span> <span class="token number">2.369121</span>
<span class="token punctuation">[</span><span class="token date number">2022-04-21</span> <span class="token time number">15:45:26,051</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token level info keyword">INFO</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>my_model_trainer_classification<span class="token punctuation">.</span>py<span class="token operator">:</span><span class="token number">52</span><span class="token operator">:</span>train<span class="token punctuation">]</span> <span class="token property">Update Epoch:</span> <span class="token number">0</span> <span class="token punctuation">[</span><span class="token number">20</span><span class="token operator">/</span><span class="token number">20</span> <span class="token operator">(</span><span class="token number">100</span><span class="token operator">%</span><span class="token operator">)</span><span class="token punctuation">]</span>  <span class="token property">Loss:</span> <span class="token number">2.222175</span>
<span class="token punctuation">[</span><span class="token date number">2022-04-21</span> <span class="token time number">15:45:26,053</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token level info keyword">INFO</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>my_model_trainer_classification<span class="token punctuation">.</span>py<span class="token operator">:</span><span class="token number">57</span><span class="token operator">:</span>train<span class="token punctuation">]</span> Client Index <span class="token operator">=</span> <span class="token number">0</span>    Epoch<span class="token operator">:</span> <span class="token number">0</span>   Loss<span class="token operator">:</span> <span class="token number">2.295648</span>
<span class="token punctuation">[</span><span class="token date number">2022-04-21</span> <span class="token time number">15:45:26,057</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token level info keyword">INFO</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>my_model_trainer_classification<span class="token punctuation">.</span>py<span class="token operator">:</span><span class="token number">52</span><span class="token operator">:</span>train<span class="token punctuation">]</span> <span class="token property">Update Epoch:</span> <span class="token number">0</span> <span class="token punctuation">[</span><span class="token number">10</span><span class="token operator">/</span><span class="token number">80</span> <span class="token operator">(</span><span class="token number">12</span><span class="token operator">%</span><span class="token operator">)</span><span class="token punctuation">]</span>   <span class="token property">Loss:</span> <span class="token number">2.237719</span>
<span class="token punctuation">[</span><span class="token date number">2022-04-21</span> <span class="token time number">15:45:26,059</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token level info keyword">INFO</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>my_model_trainer_classification<span class="token punctuation">.</span>py<span class="token operator">:</span><span class="token number">52</span><span class="token operator">:</span>train<span class="token punctuation">]</span> <span class="token property">Update Epoch:</span> <span class="token number">0</span> <span class="token punctuation">[</span><span class="token number">20</span><span class="token operator">/</span><span class="token number">80</span> <span class="token operator">(</span><span class="token number">25</span><span class="token operator">%</span><span class="token operator">)</span><span class="token punctuation">]</span>   <span class="token property">Loss:</span> <span class="token number">2.212439</span>
<span class="token punctuation">[</span><span class="token date number">2022-04-21</span> <span class="token time number">15:45:26,060</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token level info keyword">INFO</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>my_model_trainer_classification<span class="token punctuation">.</span>py<span class="token operator">:</span><span class="token number">52</span><span class="token operator">:</span>train<span class="token punctuation">]</span> <span class="token property">Update Epoch:</span> <span class="token number">0</span> <span class="token punctuation">[</span><span class="token number">30</span><span class="token operator">/</span><span class="token number">80</span> <span class="token operator">(</span><span class="token number">38</span><span class="token operator">%</span><span class="token operator">)</span><span class="token punctuation">]</span>   <span class="token property">Loss:</span> <span class="token number">2.156245</span>
<span class="token punctuation">[</span><span class="token date number">2022-04-21</span> <span class="token time number">15:45:26,062</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token level info keyword">INFO</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>my_model_trainer_classification<span class="token punctuation">.</span>py<span class="token operator">:</span><span class="token number">52</span><span class="token operator">:</span>train<span class="token punctuation">]</span> <span class="token property">Update Epoch:</span> <span class="token number">0</span> <span class="token punctuation">[</span><span class="token number">40</span><span class="token operator">/</span><span class="token number">80</span> <span class="token operator">(</span><span class="token number">50</span><span class="token operator">%</span><span class="token operator">)</span><span class="token punctuation">]</span>   <span class="token property">Loss:</span> <span class="token number">2.132013</span>
<span class="token punctuation">[</span><span class="token date number">2022-04-21</span> <span class="token time number">15:45:26,064</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token level info keyword">INFO</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>my_model_trainer_classification<span class="token punctuation">.</span>py<span class="token operator">:</span><span class="token number">52</span><span class="token operator">:</span>train<span class="token punctuation">]</span> <span class="token property">Update Epoch:</span> <span class="token number">0</span> <span class="token punctuation">[</span><span class="token number">50</span><span class="token operator">/</span><span class="token number">80</span> <span class="token operator">(</span><span class="token number">62</span><span class="token operator">%</span><span class="token operator">)</span><span class="token punctuation">]</span>   <span class="token property">Loss:</span> <span class="token number">1.966263</span>
<span class="token punctuation">[</span><span class="token date number">2022-04-21</span> <span class="token time number">15:45:26,067</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token level info keyword">INFO</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>my_model_trainer_classification<span class="token punctuation">.</span>py<span class="token operator">:</span><span class="token number">52</span><span class="token operator">:</span>train<span class="token punctuation">]</span> <span class="token property">Update Epoch:</span> <span class="token number">0</span> <span class="token punctuation">[</span><span class="token number">60</span><span class="token operator">/</span><span class="token number">80</span> <span class="token operator">(</span><span class="token number">75</span><span class="token operator">%</span><span class="token operator">)</span><span class="token punctuation">]</span>   <span class="token property">Loss:</span> <span class="token number">2.014680</span>
<span class="token punctuation">[</span><span class="token date number">2022-04-21</span> <span class="token time number">15:45:26,068</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token level info keyword">INFO</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>my_model_trainer_classification<span class="token punctuation">.</span>py<span class="token operator">:</span><span class="token number">52</span><span class="token operator">:</span>train<span class="token punctuation">]</span> <span class="token property">Update Epoch:</span> <span class="token number">0</span> <span class="token punctuation">[</span><span class="token number">70</span><span class="token operator">/</span><span class="token number">80</span> <span class="token operator">(</span><span class="token number">88</span><span class="token operator">%</span><span class="token operator">)</span><span class="token punctuation">]</span>   <span class="token property">Loss:</span> <span class="token number">1.959164</span>
<span class="token punctuation">[</span><span class="token date number">2022-04-21</span> <span class="token time number">15:45:26,070</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token level info keyword">INFO</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>my_model_trainer_classification<span class="token punctuation">.</span>py<span class="token operator">:</span><span class="token number">52</span><span class="token operator">:</span>train<span class="token punctuation">]</span> <span class="token property">Update Epoch:</span> <span class="token number">0</span> <span class="token punctuation">[</span><span class="token number">80</span><span class="token operator">/</span><span class="token number">80</span> <span class="token operator">(</span><span class="token number">100</span><span class="token operator">%</span><span class="token operator">)</span><span class="token punctuation">]</span>  <span class="token property">Loss:</span> <span class="token number">2.071570</span>
<span class="token punctuation">[</span><span class="token date number">2022-04-21</span> <span class="token time number">15:45:26,070</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token level info keyword">INFO</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>my_model_trainer_classification<span class="token punctuation">.</span>py<span class="token operator">:</span><span class="token number">57</span><span class="token operator">:</span>train<span class="token punctuation">]</span> Client Index <span class="token operator">=</span> <span class="token number">0</span>    Epoch<span class="token operator">:</span> <span class="token number">0</span>   Loss<span class="token operator">:</span> <span class="token number">2.093762</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>At the end of the program run, we can see the following output,which indicate that we have successfully finished the entire process:</p><div class="language-log line-numbers-mode" data-ext="log"><pre class="language-log"><code><span class="token level info keyword">INFO</span><span class="token operator">:</span>root<span class="token operator">:</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span>Communication round <span class="token operator">:</span> <span class="token number">197</span>
<span class="token level info keyword">INFO</span><span class="token operator">:</span>root<span class="token operator">:</span>client_indexes <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">954</span> <span class="token number">887</span> <span class="token number">866</span>  <span class="token number">96</span> <span class="token number">130</span> <span class="token number">891</span> <span class="token number">444</span> <span class="token number">925</span> <span class="token number">516</span> <span class="token number">308</span><span class="token punctuation">]</span>
<span class="token level info keyword">INFO</span><span class="token operator">:</span>root<span class="token operator">:</span>client_indexes <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">954</span> <span class="token number">887</span> <span class="token number">866</span>  <span class="token number">96</span> <span class="token number">130</span> <span class="token number">891</span> <span class="token number">444</span> <span class="token number">925</span> <span class="token number">516</span> <span class="token number">308</span><span class="token punctuation">]</span>
<span class="token level info keyword">INFO</span><span class="token operator">:</span>root<span class="token operator">:</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span>Communication round <span class="token operator">:</span> <span class="token number">198</span>
<span class="token level info keyword">INFO</span><span class="token operator">:</span>root<span class="token operator">:</span>client_indexes <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">276</span> <span class="token number">317</span> <span class="token number">986</span> <span class="token number">132</span>  <span class="token number">19</span> <span class="token number">794</span> <span class="token number">485</span> <span class="token number">973</span>  <span class="token number">28</span> <span class="token number">750</span><span class="token punctuation">]</span>
<span class="token level info keyword">INFO</span><span class="token operator">:</span>root<span class="token operator">:</span>client_indexes <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">276</span> <span class="token number">317</span> <span class="token number">986</span> <span class="token number">132</span>  <span class="token number">19</span> <span class="token number">794</span> <span class="token number">485</span> <span class="token number">973</span>  <span class="token number">28</span> <span class="token number">750</span><span class="token punctuation">]</span>
<span class="token level info keyword">INFO</span><span class="token operator">:</span>root<span class="token operator">:</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span>Communication round <span class="token operator">:</span> <span class="token number">199</span>
<span class="token level info keyword">INFO</span><span class="token operator">:</span>root<span class="token operator">:</span>client_indexes <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">221</span> <span class="token number">905</span> <span class="token number">942</span> <span class="token number">888</span> <span class="token number">711</span> <span class="token number">479</span> <span class="token number">506</span> <span class="token number">685</span> <span class="token number">436</span> <span class="token number">661</span><span class="token punctuation">]</span>
<span class="token level info keyword">INFO</span><span class="token operator">:</span>root<span class="token operator">:</span>client_indexes <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">221</span> <span class="token number">905</span> <span class="token number">942</span> <span class="token number">888</span> <span class="token number">711</span> <span class="token number">479</span> <span class="token number">506</span> <span class="token number">685</span> <span class="token number">436</span> <span class="token number">661</span><span class="token punctuation">]</span>
<span class="token level info keyword">INFO</span><span class="token operator">:</span>root<span class="token operator">:</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span>local_test_on_all_clients <span class="token operator">:</span> <span class="token number">199</span>
<span class="token level info keyword">INFO</span><span class="token operator">:</span>root<span class="token operator">:</span><span class="token operator">{</span><span class="token string">&#39;training_acc&#39;</span><span class="token operator">:</span> <span class="token number">0.8190029839128179</span><span class="token punctuation">,</span> <span class="token string">&#39;training_loss&#39;</span><span class="token operator">:</span> <span class="token number">1.7344120322737784</span><span class="token operator">}</span>
<span class="token level info keyword">INFO</span><span class="token operator">:</span>root<span class="token operator">:</span><span class="token operator">{</span><span class="token string">&#39;test_acc&#39;</span><span class="token operator">:</span> <span class="token number">0.8188848188848189</span><span class="token punctuation">,</span> <span class="token string">&#39;test_loss&#39;</span><span class="token operator">:</span> <span class="token number">1.73456031979222</span><span class="token operator">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>The code for <code>torch_fedavg_mnist_lr_one_line_example.py</code> is shown below:</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">import</span> fedml

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">&quot;__main__&quot;</span><span class="token punctuation">:</span>
    fedml<span class="token punctuation">.</span>run_simulation<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>As you can see, the <code>main()</code> function is a single line of code that implements the training of a standalone simulation of federal learning.</p><h3 id="step-4-view-the-results" tabindex="-1"><a class="header-anchor" href="#step-4-view-the-results" aria-hidden="true">#</a> step 4. view the results</h3><p>You can view the output log files in the <code>/log</code> directory under the current directory</p><h2 id="step-by-step-api" tabindex="-1"><a class="header-anchor" href="#step-by-step-api" aria-hidden="true">#</a> Step by step API</h2><p>In this section, we will present how to use FedML to implement a stand-alone simulated version of the FedAvg algorithm on the MNIST dataset by calling specific functions <strong>step by step</strong> in the code.</p><p>First we should also complete the step1 and step2 operations in the <strong>one line example</strong>, and then quickly implement the federation learning model training on the MNIST dataset with the following line of code for a single machine simulation.</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>python torch_fedavg_mnist_lr_step_by_step_example.py <span class="token parameter variable">--cf</span> fedml_config.yaml
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>The following steps are implemented in <code>torch_fedavg_mnist_lr_step_by_step_example.py</code></p><ul><li><p><strong>Init FedML framework :</strong> initialize FedML framework, get the parameter settings of each part(<code>args</code>)</p></li><li><p><strong>Init device:</strong> set the <code>device</code> to run according to the parameters related to device settings.</p></li><li><p><strong>Load data:</strong> load the dataset information(<code>dataset</code>) and the dimension of the task output (<code>output_dim</code>)according to the parameters related to data. For example, the current dataset is a 10 classification task, so the dimension of the task output is 10.</p></li><li><p><strong>Load model:</strong> load the initialized <code>model</code> according to the parameters related to the model.</p></li><li><p><strong>Start training:</strong> initialize the standalone simulator object <code>Simulator(args, device, dataset, model)</code> with <code>args</code>, <code>device</code>, <code>dataset</code>, <code>model</code> values, and then call run() on the object to start training.</p></li></ul><h2 id="custom-data-and-model" tabindex="-1"><a class="header-anchor" href="#custom-data-and-model" aria-hidden="true">#</a> Custom data and model</h2><p>In this section we will present how to <strong>customize the dataset and model</strong> using FedML based on the <code>Step by step example</code> and implement a stand-alone simulated version of the FedAvg algorithm.</p><p>First we still need to complete the first two cases step1 and step2, and then we can quickly implement the federation learning model training on the MNIST dataset with the following line of code for stand-alone simulation:</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>python torch_fedavg_mnist_lr_custum_data_and_model_example.py <span class="token parameter variable">--cf</span> fedml_config.yaml
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>The <code>torch_fedavg_mnist_lr_custum_data_and_model_example.py</code> defines the</p><p><code>load_data(args)</code> function for loading the dataset and related information, and the</p><p><code>LogisticRegression(torch.nn. Module)</code> class defines the LogisticRegression model. The specific code is as follows:</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">load_data</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">:</span>
    download_mnist<span class="token punctuation">(</span>args<span class="token punctuation">.</span>data_cache_dir<span class="token punctuation">)</span>
    fedml<span class="token punctuation">.</span>logger<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">&quot;load_data. dataset_name = %s&quot;</span> <span class="token operator">%</span> args<span class="token punctuation">.</span>dataset<span class="token punctuation">)</span>

    <span class="token triple-quoted-string string">&quot;&quot;&quot;
    Please read through the data loader at to see how to customize the dataset for FedML framework.
    &quot;&quot;&quot;</span>
    <span class="token punctuation">(</span>
        client_num<span class="token punctuation">,</span>
        train_data_num<span class="token punctuation">,</span>
        test_data_num<span class="token punctuation">,</span>
        train_data_global<span class="token punctuation">,</span>
        test_data_global<span class="token punctuation">,</span>
        train_data_local_num_dict<span class="token punctuation">,</span>
        train_data_local_dict<span class="token punctuation">,</span>
        test_data_local_dict<span class="token punctuation">,</span>
        class_num<span class="token punctuation">,</span>
    <span class="token punctuation">)</span> <span class="token operator">=</span> load_partition_data_mnist<span class="token punctuation">(</span>
        args<span class="token punctuation">.</span>batch_size<span class="token punctuation">,</span>
        train_path<span class="token operator">=</span>args<span class="token punctuation">.</span>data_cache_dir <span class="token operator">+</span> <span class="token string">&quot;MNIST/train&quot;</span><span class="token punctuation">,</span>
        test_path<span class="token operator">=</span>args<span class="token punctuation">.</span>data_cache_dir <span class="token operator">+</span> <span class="token string">&quot;MNIST/test&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;
    For shallow NN or linear models, 
    we uniformly sample a fraction of clients each round (as the original FedAvg paper)
    &quot;&quot;&quot;</span>
    args<span class="token punctuation">.</span>client_num_in_total <span class="token operator">=</span> client_num
    dataset <span class="token operator">=</span> <span class="token punctuation">[</span>
        train_data_num<span class="token punctuation">,</span>
        test_data_num<span class="token punctuation">,</span>
        train_data_global<span class="token punctuation">,</span>
        test_data_global<span class="token punctuation">,</span>
        train_data_local_num_dict<span class="token punctuation">,</span>
        train_data_local_dict<span class="token punctuation">,</span>
        test_data_local_dict<span class="token punctuation">,</span>
        class_num<span class="token punctuation">,</span>
    <span class="token punctuation">]</span>
    <span class="token keyword">return</span> dataset<span class="token punctuation">,</span> class_num

<span class="token keyword">class</span> <span class="token class-name">LogisticRegression</span><span class="token punctuation">(</span>torch<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> input_dim<span class="token punctuation">,</span> output_dim<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span>LogisticRegression<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>linear <span class="token operator">=</span> torch<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span>input_dim<span class="token punctuation">,</span> output_dim<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">:</span>
        outputs <span class="token operator">=</span> torch<span class="token punctuation">.</span>sigmoid<span class="token punctuation">(</span>self<span class="token punctuation">.</span>linear<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> outputs
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>torch_fedavg_mnist_lr_custum_data_and_model_example.py</code> is similar to <code>torch_fedavg_mnist_lr_step_by_step_example.py</code>, the code includes the same parts, though <code>torch_fedavg_mnist_lr_custum_data_and_model_example.py</code> loads the dataset and the model definition part using custom function and class. The code for the training process is shown below:</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">&quot;__main__&quot;</span><span class="token punctuation">:</span>
    <span class="token comment"># init FedML framework</span>
    args <span class="token operator">=</span> fedml<span class="token punctuation">.</span>init<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment"># init device</span>
    device <span class="token operator">=</span> fedml<span class="token punctuation">.</span>device<span class="token punctuation">.</span>get_device<span class="token punctuation">(</span>args<span class="token punctuation">)</span>

    <span class="token comment"># load data</span>
    dataset<span class="token punctuation">,</span> output_dim <span class="token operator">=</span> load_data<span class="token punctuation">(</span>args<span class="token punctuation">)</span>

    <span class="token comment"># load model (the size of MNIST image is 28 x 28)</span>
    model <span class="token operator">=</span> LogisticRegression<span class="token punctuation">(</span><span class="token number">28</span> <span class="token operator">*</span> <span class="token number">28</span><span class="token punctuation">,</span> output_dim<span class="token punctuation">)</span>

    <span class="token comment"># start training</span>
    simulator <span class="token operator">=</span> Simulator<span class="token punctuation">(</span>args<span class="token punctuation">,</span> device<span class="token punctuation">,</span> dataset<span class="token punctuation">,</span> model<span class="token punctuation">)</span>
    simulator<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,29);function I(x,N){const a=o("ExternalLinkIcon");return c(),l("div",null,[r,u,s("p",null,[n("In this example, we will present how to apply the standalone simulation of FedML in the MINIST image classification "),k,n(". The complete code is available at "),s("a",d,[n("https://github.com/FedML-AI/FedML/tree/master/python/examples/simulation/sp_fedavg_mnist_lr_example"),e(a)]),n(".")]),m,s("p",null,[n("In the current example,"),b,n(" is "),v,n(", which means that the training here is a stand-alone simulation version,"),_,n(" is "),h,n(" corresponding to the current dataset used, "),g,n(" is "),f,n(", which means that the current model used is "),y,n(" . Please refer to "),s("a",w,[n("https://github.com/FedML-AI/FedML/tree/master/python/examples"),e(a)]),n(" for other parameters and more detailed setup instructions.")]),F])}const L=p(i,[["render",I],["__file","sp_fedavg_mnist_lr_example.html.vue"]]);export{L as default};
